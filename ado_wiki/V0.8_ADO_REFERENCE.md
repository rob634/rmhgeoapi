# ADO Reference Documentation - Geospatial API for DDH

**Created**: 31 JAN 2026
**Purpose**: Wiki/reference content for ADO - NOT work items
**Related**: V0.8_ADO_WORKITEMS.md (work items for API import)

---

## Standards Compliance

This platform implements **OGC (Open Geospatial Consortium)** standards throughout. OGC is the international consortium that defines how geospatial data is shared and accessed. Members include **Microsoft, AWS, Google, NASA, ESA, USGS**, and 500+ organizations worldwide.

**Why this matters**: OGC-compliant APIs work with any standards-based client—no vendor lock-in, no proprietary formats. Data published here can be consumed by any OGC-compatible tool.

| Standard | Purpose | Used By |
|----------|---------|---------|
| **OGC API - Features** | Query vector data via REST | ArcGIS, QGIS, MapLibre |
| **OGC API - Tiles** | Serve map tiles (raster & vector) | Google Maps, Mapbox, Leaflet |
| **STAC** | Catalog & discover datasets | Microsoft Planetary Computer, AWS Earth |
| **Cloud Optimized GeoTIFF** | Stream raster data without download | All major cloud platforms |

---

## User Tiers

| Tier | Name | Examples | Access Level |
|------|------|----------|--------------|
| **Tier 1** | Platform Ops | platform operations team | Full platform access |
| **Tier 2** | B2B Integrators | DDH ITSDA team, DEC developers, data stewards | API access for orchestration |
| **Tier 3** | B2C End Users | WB staff (OUO), external researchers (PUBLIC) | Data consumption only |

---

## Value Streams

### VS1: Vector Data Publishing & Consumption
**Journey**: Data Publisher (B2B) → Governance Approval (B2B) → End User Access (B2C)

**Flow**:
1. B2B user uploads CSV/GeoJSON/Shapefile/KML via Platform API
2. Platform validates, transforms to EPSG:4326, loads to PostGIS
3. STAC item created, pending approval
4. Data steward approves via governance workflow
5. B2C users query via OGC Features API in QGIS/Python/web maps
6. B2C users consume vector tiles in web applications
7. PUBLIC-approved data routed to external delivery via ADF

**Features**: F3 (Vector Pipeline) → F4 (Governance) → F5 (TiPG APIs)
**Status**: Complete end-to-end
**Dependencies**: F1 (Job Orchestration)

**Service Layer Routing**:
- OUO data → Internal service layer (WB staff only)
- PUBLIC data → Internal + External service layer (Cloudflare CDN → public)

---

### VS2: Raster Data Publishing & Consumption
**Journey**: Data Publisher (B2B) → Governance Approval (B2B) → End User Access (B2C)

**Flow**:
1. B2B user uploads GeoTIFF via Platform API
2. Platform converts to Cloud Optimized GeoTIFF (COG)
3. STAC item created with COG asset links
4. Data steward approves via governance workflow
5. B2C users view tiles in web maps
6. B2C users extract pixel values and statistics via API
7. PUBLIC-approved data routed to external delivery via ADF

**Features**: F2 (Raster Pipeline) → F4 (Governance) → F5 (TiTiler APIs)
**Status**: Complete end-to-end
**Dependencies**: F1 (Job Orchestration)

**Service Layer Routing**:
- OUO data → Internal service layer (WB staff only)
- PUBLIC data → Internal + External service layer (Cloudflare CDN → public)

---

### VS3: B2B Platform Integration
**Journey**: B2B Developer → Working Integration → B2C Users Access Geospatial via B2B Application

**Flow**:
1. Platform admin grants B2B app Managed Identity access
2. B2B developers review API documentation via Developer Portal
3. Platform team provisions UAT/Prod environments
4. B2B developers integrate Platform API for job submission (orchestration)
5. B2B developers embed Service Layer APIs for data consumption
6. B2C users access geospatial features within B2B application interface

**Features**: F7 (Integration) → F1 (Orchestration) → F2/F3 (Pipelines) → F5 (Service APIs) + F6 (Developer Portal)
**Status**: In Progress - Blocked by eService RITMs

**Blockers**:
- RITM00009453692: ADF Contributor access for external delivery
- RITM00009453723: Entra Auth for API (replace client/secret with MI)
- RITM00009447599: Docker deployment ACN approval

---

### VS4: NetCDF/Zarr Data Publishing (VirtualiZarr)
**Journey**: Climate Data Request (B2B) → VirtualiZarr Processing → Hosted Multidimensional Dataset (B2C Access)

**Flow**:
1. Climate analyst requests NetCDF hosting
2. Platform generates Kerchunk JSON references
3. TiTiler-xarray serves NetCDF directly via JSON references
4. Data steward approves dataset
5. B2C users access time-series climate data via tiles and queries
6. **No data duplication**: Original NetCDF files served directly

**Features**: F1 (VirtualiZarr Pipeline) → F4 (Governance) → F5 (TiTiler-xarray)
**Status**: Planned - Critical deliverable
**Business Value**: Eliminates NetCDF → Zarr conversion, saves TB-scale storage

---

## Epic Requirements

These architectural requirements apply to all Features:

| Requirement | Standard | Description |
|-------------|----------|-------------|
| **Zero Trust Security** | [Microsoft Zero Trust](https://learn.microsoft.com/en-us/security/zero-trust/) | Azure Entra ID + Managed Identity only. No passwords, connection strings, or API keys. |
| **OGC Standards** | [OGC API](https://ogcapi.ogc.org/) | All APIs implement OGC specifications |
| **Horizontally Scalable** | Cloud-Native | Containerized workloads scale out automatically under load |
| **Stateless Workers** | [12-Factor App](https://12factor.net/) | All processing nodes are stateless; state lives in PostgreSQL and Azure Storage |
| **Queue-Based Orchestration** | Event-Driven | Async job processing via Azure Service Bus |
| **Infrastructure as Code** | [Azure Bicep](https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/) | All Azure resources deployable via ARM/Bicep |

---

## Service Layer Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        DATA CLASSIFICATION                       │
├─────────────────────────────────────────────────────────────────┤
│  OUO (Official Use Only)    │    PUBLIC (Approved for Release)  │
└──────────────┬──────────────┴──────────────┬────────────────────┘
               │                              │
               ▼                              ▼
┌──────────────────────────┐    ┌──────────────────────────────────┐
│   INTERNAL SERVICE LAYER │    │   EXTERNAL SERVICE LAYER         │
│   (All approved data)    │    │   (PUBLIC data only)             │
│                          │    │                                  │
│   - WB Staff access      │    │   - Cloudflare CDN               │
│   - Entra ID auth        │    │   - Public internet access       │
│   - OUO + PUBLIC data    │    │   - ADF-managed delivery         │
└──────────────────────────┘    └──────────────────────────────────┘
```

---

## Feature Dependency Map

```
F1: ETL Orchestration (foundation)
 │
 ├──► F2: Raster Pipeline ──┐
 │                          │
 ├──► F3: Vector Pipeline ──┼──► F4: Governance ──► F5: Service Layer
 │                          │
 └──► F7: DDH Integration ──┘
                            │
                            └──► F6: Admin/Developer Portal
```

---

## Integration Pattern: DDH

**B2B (Orchestration)**:
```
DDH App ──► Platform API ──► Job Queue ──► ETL Pipeline ──► Data Published
```

**B2C (Consumption)**:
```
DDH App ──► Service Layer APIs ──► OGC Tiles/Features/STAC ──► End User
```

---

*End of Reference Documentation*
