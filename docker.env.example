# ============================================================================
# Docker Worker Environment Variables
# ============================================================================
# Copy this file to docker.env and fill in values for local testing.
# For Azure deployment, set these in Web App configuration.
#
# Usage:
#   docker run --env-file docker.env geospatial-worker:latest
#
# Updated: 27 JAN 2026 (V0.8)
# ============================================================================

# =============================================================================
# APP MODE (Required for Docker Worker)
# =============================================================================
APP_MODE=worker_docker
APP_NAME=docker-worker-local
ENVIRONMENT=dev

# =============================================================================
# MANAGED IDENTITY AUTHENTICATION (Required for Azure)
# =============================================================================
# User-assigned managed identity is RECOMMENDED over system-assigned because:
# - Can be pre-created and assigned RBAC roles before deployment
# - Same identity can be shared across multiple containers
# - Survives container recreation
#
# Prerequisites:
# 1. Create user-assigned managed identity in Azure Portal
# 2. Assign to Web App (Settings > Identity > User assigned)
# 3. Grant RBAC roles:
#    - PostgreSQL: Create database user matching identity name
#    - Storage: Storage Blob Data Contributor on storage accounts
#    - Service Bus: Azure Service Bus Data Receiver on namespace
# 4. Set the variables below

USE_MANAGED_IDENTITY=true

# Client ID of the user-assigned managed identity (from Azure Portal)
# Format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
DB_ADMIN_MANAGED_IDENTITY_CLIENT_ID=

# PostgreSQL user name (must match the identity name in database)
# This is created via: SELECT * FROM pgaadauth_create_principal('identity-name', false, false);
DB_ADMIN_MANAGED_IDENTITY_NAME=

# =============================================================================
# DATABASE (Required)
# =============================================================================
POSTGIS_HOST=your-server.postgres.database.azure.com
POSTGIS_DATABASE=geo
POSTGIS_PORT=5432

# For password auth (LOCAL DEVELOPMENT ONLY - not recommended for production)
# POSTGIS_USER=your-admin-user
# POSTGIS_PASSWORD=your-password
# USE_MANAGED_IDENTITY=false

# =============================================================================
# DATABASE SCHEMAS (Required)
# =============================================================================
POSTGIS_SCHEMA=geo
APP_SCHEMA=app
PGSTAC_SCHEMA=pgstac
H3_SCHEMA=h3

# =============================================================================
# STORAGE (Required)
# =============================================================================
# Storage account names (without .blob.core.windows.net)
# Must have Storage Blob Data Contributor role assigned to managed identity

BRONZE_STORAGE_ACCOUNT=yourbronzestorage
SILVER_STORAGE_ACCOUNT=yoursilverstorage

# Optional - defaults to SILVER if not set
# SILVEREXT_STORAGE_ACCOUNT=yoursilverextstorage
# GOLD_STORAGE_ACCOUNT=yourgoldstorage

# =============================================================================
# SERVICE BUS (Required)
# =============================================================================
# IMPORTANT: Use SERVICE_BUS_FQDN (not SERVICE_BUS_NAMESPACE)
# Must include full domain: yournamespace.servicebus.windows.net

SERVICE_BUS_FQDN=yournamespace.servicebus.windows.net

# Queue names (have defaults - only set if using custom names)
# SERVICE_BUS_CONTAINER_TASKS_QUEUE=container-tasks
# SERVICE_BUS_FUNCTIONAPP_TASKS_QUEUE=functionapp-tasks

# =============================================================================
# RASTER PROCESSING CONFIG (V0.8)
# =============================================================================
# Mount-based processing (recommended for large files)
RASTER_USE_ETL_MOUNT=true
RASTER_ETL_MOUNT_PATH=/mounts/etl-temp

# Tiling thresholds (in MB)
# RASTER_TILING_THRESHOLD_MB=2000
# RASTER_TILE_TARGET_MB=400

# COG creation settings
# RASTER_COG_COMPRESSION=LZW
# RASTER_TARGET_CRS=EPSG:4326

# =============================================================================
# OBSERVABILITY (Recommended)
# =============================================================================
# Application Insights connection string (from Azure Portal)
# IMPORTANT: Use same App Insights as Function App for unified logging
APPLICATIONINSIGHTS_CONNECTION_STRING=

# For AAD-based App Insights auth (recommended)
# APPLICATIONINSIGHTS_AUTHENTICATION_STRING=Authorization=AAD

LOG_LEVEL=INFO

# Enable debug instrumentation (memory tracking, latency logging)
OBSERVABILITY_MODE=false

# =============================================================================
# EXTERNAL SERVICES (Optional)
# =============================================================================
# TiTiler URL for COG preview/visualization
# TITILER_BASE_URL=https://yourtitiler.azurewebsites.net

# ETL App URL for callbacks
# ETL_APP_URL=https://youretlapp.azurewebsites.net

# =============================================================================
# DOCKER WORKER FLAGS (Optional - have defaults)
# =============================================================================
# Enable Docker worker queue validation
# DOCKER_WORKER_ENABLED=true

# Docker worker URL for health checks (from Function App perspective)
# DOCKER_WORKER_URL=https://yourdockerworker.azurewebsites.net
