# ============================================================================
# Docker Worker Environment Variables
# ============================================================================
# Copy this file to docker.env and fill in values for local testing.
# For Azure deployment, set these in Container App configuration.
#
# Usage:
#   docker run --env-file docker.env geospatial-worker:latest
#
# Updated: 10 JAN 2026
# ============================================================================

# =============================================================================
# APP MODE (Required)
# =============================================================================
APP_MODE=worker_docker
APP_NAME=docker-worker-01

# =============================================================================
# MANAGED IDENTITY AUTHENTICATION (Recommended for Azure)
# =============================================================================
# User-assigned managed identity is RECOMMENDED over system-assigned because:
# - Can be pre-created and assigned RBAC roles before deployment
# - Same identity can be shared across multiple containers
# - Survives container recreation
#
# Prerequisites:
# 1. Create user-assigned managed identity in Azure Portal
# 2. Assign to Container App (Settings > Identity > User assigned)
# 3. Grant RBAC roles:
#    - PostgreSQL: Create database user matching identity name
#    - Storage: Storage Blob Data Contributor on storage account
# 4. Set the variables below

USE_MANAGED_IDENTITY=true

# Client ID of the user-assigned managed identity (from Azure Portal)
# Format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
DB_ADMIN_MANAGED_IDENTITY_CLIENT_ID=

# PostgreSQL user name (must match the identity name in database)
# This is created via: SELECT * FROM pgaadauth_create_principal('identity-name', false, false);
DB_ADMIN_MANAGED_IDENTITY_NAME=rmhgeoapi-identity

# =============================================================================
# DATABASE (Required)
# =============================================================================
POSTGIS_HOST=rmhpostgres.postgres.database.azure.com
POSTGIS_DATABASE=geo
POSTGIS_PORT=5432

# For password auth (LOCAL DEVELOPMENT ONLY - not recommended for production)
# POSTGIS_USER=your-admin-user
# POSTGIS_PASSWORD=your-password
# USE_MANAGED_IDENTITY=false

# =============================================================================
# DATABASE SCHEMAS (Required)
# =============================================================================
POSTGIS_SCHEMA=geo
APP_SCHEMA=app
PGSTAC_SCHEMA=pgstac
H3_SCHEMA=h3

# =============================================================================
# STORAGE (Required for blob operations)
# =============================================================================
# Storage account name (without .blob.core.windows.net)
AZURE_STORAGE_ACCOUNT_NAME=rmhazuregeo

# For multi-account setup (optional)
# BRONZE_STORAGE_ACCOUNT=rmhazuregeobronze
# SILVER_STORAGE_ACCOUNT=rmhazuregeosilver

# =============================================================================
# SERVICE BUS (Required for queue processing)
# =============================================================================
# Option 1: Managed Identity (recommended for Azure)
SERVICE_BUS_NAMESPACE=rmhazure.servicebus.windows.net

# Option 2: Connection String (for local development)
# ServiceBusConnection=Endpoint=sb://your-namespace.servicebus.windows.net/;SharedAccessKeyName=...

# Queue name (default: long-running-tasks)
# SERVICE_BUS_LONG_RUNNING_TASKS_QUEUE=long-running-tasks

# =============================================================================
# LOGGING & OBSERVABILITY (Optional)
# =============================================================================
LOG_LEVEL=INFO

# Enable debug instrumentation (memory tracking, latency logging)
OBSERVABILITY_MODE=false

# Enable ETL metrics to PostgreSQL (for dashboards)
METRICS_ENABLED=true

# =============================================================================
# CONTAINER CONFIGURATION (Optional - for Azure Container Apps)
# =============================================================================
# Port for HTTP server (default: 80)
# PORT=80

# =============================================================================
# RASTER CONFIG (Optional - have defaults)
# =============================================================================
# RASTER_SIZE_THRESHOLD_MB=800
# RASTER_COG_COMPRESSION=DEFLATE
# RASTER_COG_TILE_SIZE=512
