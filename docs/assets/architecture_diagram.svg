<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 580" width="1100" height="580">
<style>
    /* Component boxes */
    .comp-box { stroke-width: 2; }
    .comp-box.funcapp { fill: #FFF3CD; stroke: #FFC14D; }
    .comp-box.servicebus { fill: #E8F4FD; stroke: #0071BC; }
    .comp-box.postgres { fill: #E8F5E9; stroke: #336791; }
    .comp-box.storage { fill: #F3E5F5; stroke: #9C27B0; }
    .comp-box.appservice { fill: #E3F2FD; stroke: #1976D2; }
    .comp-box.inactive { fill: #F5F5F5; stroke: #9CA3AF; }

    /* Labels */
    .comp-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 11px; text-anchor: middle; fill: #1F2937; }
    .comp-label.disabled { fill: #9CA3AF; }
    .comp-icon { font-size: 18px; text-anchor: middle; }
    .comp-icon.disabled { opacity: 0.4; }

    /* Flow arrows */
    .flow-arrow { fill: none; stroke: #0071BC; stroke-width: 2; }
    .flow-arrow.inactive { stroke: #9CA3AF; stroke-dasharray: 5,3; }
    .flow-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 9px; fill: #6B7280; }
    .flow-label-tiny { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 8px; fill: #9CA3AF; }

    /* Header */
    .diagram-header-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 12px; font-weight: 600; fill: white; text-anchor: middle; }

    /* Status indicators */
    .status-indicator { fill: #9CA3AF; stroke: white; stroke-width: 2; }
</style>

<!-- Definitions for icons and markers -->
<defs>
    <marker id="arrowhead" markerWidth="7" markerHeight="4.9" refX="6.3" refY="2.45" orient="auto">
        <polygon points="0 0, 7 2.45, 0 4.9" fill="#0071BC"/>
    </marker>
    <marker id="arrowhead-grey" markerWidth="7" markerHeight="4.9" refX="6.3" refY="2.45" orient="auto">
        <polygon points="0 0, 7 2.45, 0 4.9" fill="#9CA3AF"/>
    </marker>
</defs>

<!-- ETL Pipelines Box -->
<rect x="510" y="195" width="295" height="282" rx="8" fill="#FAFBFC" stroke="#E1E4E8" stroke-width="1"/>
<rect x="510" y="195" width="295" height="28" rx="8" fill="#0071BC"/>
<rect x="510" y="215" width="295" height="8" fill="#0071BC"/>
<text x="657" y="214" class="diagram-header-label">ETL Pipelines</text>

<!-- Platform API -->
<g class="component" id="comp-platform-api">
    <rect x="30" y="320" width="100" height="60" rx="6" class="comp-box funcapp"/>
    <text x="80" y="345" class="comp-icon">âš¡</text>
    <text x="80" y="365" class="comp-label">Platform API</text>
    <circle cx="120" cy="330" r="8" class="status-indicator"/>
</g>

<!-- Arrow: Platform API -> Job Queues -->
<path d="M 130 350 L 175 350" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="145" y="340" class="flow-label">Queue Job</text>

<!-- Job Queues (Service Bus) -->
<g class="component" id="comp-job-queues">
    <rect x="180" y="320" width="100" height="60" rx="6" class="comp-box servicebus"/>
    <text x="230" y="345" class="comp-icon">ğŸ“¨</text>
    <text x="230" y="365" class="comp-label">Job Queues</text>
    <circle cx="270" cy="330" r="8" class="status-indicator"/>
</g>

<!-- Arrow: Job Queues -> Orchestrator -->
<path d="M 280 350 L 325 350" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="295" y="340" class="flow-label">Trigger</text>

<!-- Orchestrator -->
<g class="component" id="comp-orchestrator">
    <rect x="330" y="320" width="110" height="60" rx="6" class="comp-box funcapp"/>
    <text x="385" y="345" class="comp-icon">âš¡</text>
    <text x="385" y="365" class="comp-label">Orchestrator</text>
    <circle cx="430" cy="330" r="8" class="status-indicator"/>
</g>

<!-- Arrow: Orchestrator -> Job Tables -->
<path d="M 385 380 L 385 510" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="395" y="445" class="flow-label">Update State</text>

<!-- Job Tables -->
<g class="component" id="comp-job-tables">
    <rect x="335" y="510" width="100" height="60" rx="6" class="comp-box postgres"/>
    <text x="385" y="535" class="comp-icon">ğŸ˜</text>
    <text x="385" y="555" class="comp-label">Job Tables</text>
    <circle cx="425" cy="520" r="8" class="status-indicator"/>
</g>

<!-- Fan-out arrows from Orchestrator -->
<path d="M 440 340 L 520 265" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="460" y="290" class="flow-label">Fan-out</text>
<path d="M 440 350 L 520 350" class="flow-arrow" marker-end="url(#arrowhead)"/>
<path d="M 440 360 L 520 435" class="flow-arrow inactive" marker-end="url(#arrowhead-grey)"/>

<!-- Parallel Queue -->
<g class="component" id="comp-parallel-queue">
    <rect x="520" y="235" width="100" height="60" rx="6" class="comp-box servicebus"/>
    <text x="570" y="260" class="comp-icon">ğŸ“¨</text>
    <text x="570" y="280" class="comp-label">Parallel Queue</text>
    <circle cx="610" cy="245" r="8" class="status-indicator"/>
</g>

<path d="M 620 265 L 680 265" class="flow-arrow" marker-end="url(#arrowhead)"/>

<!-- I/O Optimized Worker -->
<g class="component" id="comp-io-worker">
    <rect x="680" y="235" width="110" height="60" rx="6" class="comp-box funcapp"/>
    <text x="735" y="260" class="comp-icon">âš¡</text>
    <text x="735" y="280" class="comp-label">I/O Optimized</text>
    <circle cx="780" cy="245" r="8" class="status-indicator"/>
</g>

<!-- Compute Queue -->
<g class="component" id="comp-compute-queue">
    <rect x="520" y="320" width="100" height="60" rx="6" class="comp-box servicebus"/>
    <text x="570" y="345" class="comp-icon">ğŸ“¨</text>
    <text x="570" y="365" class="comp-label">Compute Queue</text>
    <circle cx="610" cy="330" r="8" class="status-indicator"/>
</g>

<path d="M 620 350 L 680 350" class="flow-arrow" marker-end="url(#arrowhead)"/>

<!-- Compute Worker -->
<g class="component" id="comp-compute-worker">
    <rect x="680" y="320" width="110" height="60" rx="6" class="comp-box funcapp"/>
    <text x="735" y="345" class="comp-icon">âš¡</text>
    <text x="735" y="365" class="comp-label">Compute Worker</text>
    <circle cx="780" cy="330" r="8" class="status-indicator"/>
</g>

<!-- Long Queue (not implemented) -->
<g class="component disabled" id="comp-long-queue">
    <rect x="520" y="405" width="100" height="60" rx="6" class="comp-box inactive"/>
    <text x="570" y="430" class="comp-icon disabled">ğŸ“¨</text>
    <text x="570" y="450" class="comp-label disabled">Long Queue</text>
    <circle cx="610" cy="415" r="8" class="status-indicator"/>
</g>

<path d="M 620 435 L 680 435" class="flow-arrow inactive" marker-end="url(#arrowhead-grey)"/>

<!-- Long Worker (not implemented) -->
<g class="component disabled" id="comp-container">
    <rect x="680" y="405" width="110" height="60" rx="6" class="comp-box inactive"/>
    <text x="735" y="430" class="comp-icon disabled">ğŸ³</text>
    <text x="735" y="450" class="comp-label disabled">Long Worker</text>
    <circle cx="780" cy="415" r="8" class="status-indicator"/>
</g>

<!-- Task Complete -> Task Tables -->
<path d="M 805 350 L 870 350 L 870 510" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="835" y="340" class="flow-label">Task Complete</text>

<!-- Task Tables -->
<g class="component" id="comp-task-tables">
    <rect x="820" y="510" width="100" height="60" rx="6" class="comp-box postgres"/>
    <text x="870" y="535" class="comp-icon">ğŸ˜</text>
    <text x="870" y="555" class="comp-label">Task Tables</text>
    <circle cx="910" cy="520" r="8" class="status-indicator"/>
</g>

<!-- State Progression Feedback -->
<path d="M 820 540 L 435 540" class="flow-arrow" marker-end="url(#arrowhead)" stroke-dasharray="5,3"/>
<text x="610" y="555" class="flow-label">Last Task Triggers State Progression</text>

<!-- TiTiler-pgstac -->
<g class="component" id="comp-titiler">
    <rect x="685" y="5" width="100" height="60" rx="6" class="comp-box appservice"/>
    <text x="735" y="30" class="comp-icon">ğŸ³</text>
    <text x="735" y="50" class="comp-label">TiTiler-pgstac</text>
    <circle cx="775" cy="15" r="8" class="status-indicator"/>
</g>

<!-- OGC Features -->
<g class="component" id="comp-ogc-features">
    <rect x="820" y="5" width="100" height="60" rx="6" class="comp-box funcapp"/>
    <text x="870" y="30" class="comp-icon">âš¡</text>
    <text x="870" y="50" class="comp-label">OGC Features</text>
    <circle cx="910" cy="15" r="8" class="status-indicator"/>
</g>

<!-- Input Data -->
<g class="component" id="comp-input-storage">
    <rect x="520" y="95" width="100" height="60" rx="6" class="comp-box storage"/>
    <text x="570" y="120" class="comp-icon">ğŸ“¦</text>
    <text x="570" y="140" class="comp-label">Input Data</text>
    <circle cx="610" cy="105" r="8" class="status-indicator"/>
</g>

<!-- Output Data -->
<g class="component" id="comp-output-storage">
    <rect x="685" y="95" width="100" height="60" rx="6" class="comp-box storage"/>
    <text x="735" y="120" class="comp-icon">ğŸ“¦</text>
    <text x="735" y="140" class="comp-label">Output Data</text>
    <circle cx="775" cy="105" r="8" class="status-indicator"/>
</g>

<!-- PostGIS -->
<g class="component" id="comp-output-tables">
    <rect x="820" y="95" width="100" height="60" rx="6" class="comp-box postgres"/>
    <text x="870" y="120" class="comp-icon">ğŸ˜</text>
    <text x="870" y="140" class="comp-label">PostGIS</text>
    <circle cx="910" cy="105" r="8" class="status-indicator"/>
</g>

<!-- TiTiler-xarray (not implemented) -->
<g class="component disabled" id="comp-titiler-xarray">
    <rect x="955" y="5" width="100" height="60" rx="6" class="comp-box inactive"/>
    <text x="1005" y="30" class="comp-icon disabled">ğŸ³</text>
    <text x="1005" y="50" class="comp-label disabled">TiTiler-xarray</text>
    <circle cx="1045" cy="15" r="8" class="status-indicator"/>
</g>

<!-- Zarr Store (not implemented) -->
<g class="component disabled" id="comp-zarr-store">
    <rect x="955" y="95" width="100" height="60" rx="6" class="comp-box inactive"/>
    <text x="1005" y="120" class="comp-icon disabled">ğŸ“¦</text>
    <text x="1005" y="140" class="comp-label disabled">Zarr Store</text>
    <circle cx="1045" cy="105" r="8" class="status-indicator"/>
</g>

<!-- Data flow arrows -->
<path d="M 1005 95 L 1005 65" class="flow-arrow inactive" marker-end="url(#arrowhead-grey)"/>
<path d="M 735 95 L 735 65" class="flow-arrow" marker-end="url(#arrowhead)"/>
<path d="M 870 95 L 870 65" class="flow-arrow" marker-end="url(#arrowhead)"/>
<path d="M 570 155 L 570 195" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="580" y="178" class="flow-label-tiny">Read</text>
<path d="M 735 195 L 735 155" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="745" y="178" class="flow-label-tiny">Write</text>
<path d="M 805 225 L 870 225 L 870 155" class="flow-arrow" marker-end="url(#arrowhead)"/>
<text x="875" y="190" class="flow-label-tiny">Write</text>

</svg>
