<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Guide - Process Raster | RMH GeoAPI</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1a1a2e;
            color: #e0e0e0;
            line-height: 1.6;
        }

        /* Navigation */
        .top-nav {
            background: #16213e;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #0f3460;
        }

        .nav-brand {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4fc3f7;
        }

        .nav-links {
            display: flex;
            gap: 24px;
        }

        .nav-links a {
            color: #b0b0b0;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: #4fc3f7;
        }

        .nav-links a.active {
            color: #4fc3f7;
            font-weight: 600;
        }

        /* Main Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .page-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #0f3460;
        }

        .page-header h1 {
            color: #4fc3f7;
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #888;
            font-size: 0.9rem;
        }

        /* Block Rows */
        .block-row {
            background: #16213e;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #0f3460;
            overflow: hidden;
        }

        .block-header {
            background: #0f3460;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .block-number {
            background: #4fc3f7;
            color: #1a1a2e;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .block-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .block-subtitle {
            color: #888;
            font-size: 0.85rem;
            margin-left: auto;
        }

        .block-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .block-content.single-column {
            grid-template-columns: 1fr;
        }

        /* Form Styles */
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.85rem;
            color: #4fc3f7;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            background: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 4px;
            padding: 10px 12px;
            color: #e0e0e0;
            font-size: 0.9rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4fc3f7;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        /* Zone Badge (non-selectable) */
        .zone-badge {
            background: #cd7f32;
            color: #1a1a2e;
            padding: 10px 16px;
            border-radius: 4px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
        }

        /* File List (compact) */
        .file-list-compact {
            background: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 4px;
            height: 120px;
            overflow-y: auto;
            padding: 8px;
        }

        .file-item {
            padding: 4px 8px;
            font-size: 0.8rem;
            color: #b0b0b0;
            cursor: pointer;
            border-radius: 3px;
        }

        .file-item:hover {
            background: #0f3460;
        }

        .file-item.selected {
            background: #4fc3f7;
            color: #1a1a2e;
        }

        /* DDH Section */
        .ddh-section {
            background: #1a1a2e;
            border: 1px solid #e94560;
            border-radius: 6px;
            padding: 16px;
        }

        .ddh-section-title {
            color: #e94560;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* CURL Display */
        .curl-section {
            background: #0d1117;
            border-radius: 6px;
            overflow: hidden;
        }

        .curl-header {
            background: #161b22;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #30363d;
        }

        .curl-label {
            color: #8b949e;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .copy-btn {
            background: #238636;
            color: #fff;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #2ea043;
        }

        .curl-code {
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            color: #c9d1d9;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }

        .curl-code .cmd {
            color: #ff7b72;
        }

        .curl-code .flag {
            color: #79c0ff;
        }

        .curl-code .url {
            color: #a5d6ff;
        }

        .curl-code .string {
            color: #a5d6ff;
        }

        .curl-code .key {
            color: #7ee787;
        }

        /* Submit Button */
        .submit-btn {
            background: #4fc3f7;
            color: #1a1a2e;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .submit-btn:hover {
            background: #81d4fa;
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        /* Block 2: Monitoring */
        .monitor-mini {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .job-status-bar {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: #1a1a2e;
            border-radius: 6px;
            border: 1px solid #0f3460;
        }

        .job-id-display {
            font-family: monospace;
            font-size: 0.85rem;
            color: #4fc3f7;
        }

        .job-id-display.placeholder {
            color: #555;
            font-style: italic;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.queued { background: #ffa726; color: #1a1a2e; }
        .status-badge.processing { background: #42a5f5; color: #fff; }
        .status-badge.completed { background: #66bb6a; color: #1a1a2e; }
        .status-badge.failed { background: #ef5350; color: #fff; }

        .stages-mini {
            display: flex;
            gap: 8px;
        }

        .stage-mini {
            flex: 1;
            background: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .stage-mini.active {
            border-color: #42a5f5;
            background: rgba(66, 165, 245, 0.1);
        }

        .stage-mini.completed {
            border-color: #66bb6a;
            background: rgba(102, 187, 106, 0.1);
        }

        .stage-mini-number {
            font-size: 0.75rem;
            color: #888;
        }

        .stage-mini-name {
            font-size: 0.8rem;
            font-weight: 500;
            color: #e0e0e0;
            margin-top: 4px;
        }

        .stage-mini-status {
            font-size: 0.7rem;
            color: #888;
            margin-top: 2px;
        }

        /* Block 3: Output */
        .output-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .json-display {
            background: #0d1117;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .json-display .key {
            color: #7ee787;
        }

        .json-display .string {
            color: #a5d6ff;
        }

        .json-display .number {
            color: #79c0ff;
        }

        .json-display .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .json-display .highlight-url {
            background: rgba(79, 195, 247, 0.2);
        }

        .json-display .highlight-ddh {
            background: rgba(233, 69, 96, 0.2);
        }

        /* Workflow Arrow */
        .workflow-connector {
            display: flex;
            justify-content: center;
            padding: 8px 0;
        }

        .workflow-arrow {
            color: #4fc3f7;
            font-size: 1.5rem;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 16px;
            padding: 12px 20px;
            background: #0f3460;
            border-top: 1px solid #16213e;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.url { background: rgba(79, 195, 247, 0.4); }
        .legend-color.ddh { background: rgba(233, 69, 96, 0.4); }

        /* Responsive */
        @media (max-width: 1200px) {
            .block-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="top-nav">
        <div class="nav-brand">RMH GeoAPI</div>
        <div class="nav-links">
            <a href="#">Workflow Monitor</a>
            <a href="#">Submit Raster</a>
            <a href="#">Submit Vector</a>
            <a href="#">Health</a>
            <a href="#">API Docs</a>
            <a href="#" class="active">Integration</a>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Integration Guide: Process Raster</h1>
            <p>Step-by-step guide for DDH App integration with the raster processing workflow</p>
        </div>

        <!-- BLOCK 1: Job Submission -->
        <div class="block-row">
            <div class="block-header">
                <div class="block-number">1</div>
                <div class="block-title">Submit Processing Job</div>
                <div class="block-subtitle">POST /api/jobs/submit/process_raster_v2</div>
            </div>
            <div class="block-content">
                <!-- Left: Form -->
                <div class="form-section">
                    <!-- Zone (fixed) -->
                    <div class="form-group">
                        <label>Storage Zone</label>
                        <div class="zone-badge">BRONZE (Source Data)</div>
                    </div>

                    <!-- Container Selection -->
                    <div class="form-group">
                        <label>Container</label>
                        <select id="container-select" onchange="updateCurl()">
                            <option value="">-- Select Container --</option>
                            <option value="bronze-rasters">bronze-rasters</option>
                            <option value="bronze-fathom">bronze-fathom</option>
                            <option value="bronze-uploads">bronze-uploads</option>
                        </select>
                    </div>

                    <!-- File List (compact) -->
                    <div class="form-group">
                        <label>Select Source File</label>
                        <div class="file-list-compact" id="file-list">
                            <div class="file-item" onclick="selectFile(this, 'flood_depth_100yr.tif')">flood_depth_100yr.tif</div>
                            <div class="file-item" onclick="selectFile(this, 'elevation_dem.tif')">elevation_dem.tif</div>
                            <div class="file-item" onclick="selectFile(this, 'landcover_2024.tif')">landcover_2024.tif</div>
                            <div class="file-item" onclick="selectFile(this, 'temperature_avg.tif')">temperature_avg.tif</div>
                        </div>
                    </div>

                    <!-- DDH Identifiers Section -->
                    <div class="ddh-section">
                        <div class="ddh-section-title">
                            <span>DDH Identifiers</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Collection ID</label>
                                <input type="text" id="collection-id" placeholder="e.g., flood-risk-2024" onchange="updateCurl()">
                            </div>
                            <div class="form-group">
                                <label>Item ID</label>
                                <input type="text" id="item-id" placeholder="e.g., depth-100yr-northeast" onchange="updateCurl()">
                            </div>
                        </div>
                    </div>

                    <!-- Processing Options -->
                    <div class="form-row-3">
                        <div class="form-group">
                            <label>Output Format</label>
                            <select id="output-format" onchange="updateCurl()">
                                <option value="COG">COG (Cloud Optimized)</option>
                                <option value="GeoTIFF">GeoTIFF</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Compression</label>
                            <select id="compression" onchange="updateCurl()">
                                <option value="LZW">LZW</option>
                                <option value="DEFLATE">DEFLATE</option>
                                <option value="ZSTD">ZSTD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Target CRS</label>
                            <select id="target-crs" onchange="updateCurl()">
                                <option value="EPSG:4326">EPSG:4326 (WGS84)</option>
                                <option value="EPSG:3857">EPSG:3857 (Web Mercator)</option>
                            </select>
                        </div>
                    </div>

                    <button class="submit-btn" onclick="simulateSubmit()">Submit Job</button>
                </div>

                <!-- Right: CURL -->
                <div class="curl-section">
                    <div class="curl-header">
                        <span class="curl-label">CURL Command</span>
                        <button class="copy-btn" onclick="copyCurl('curl-submit')">Copy</button>
                    </div>
                    <pre class="curl-code" id="curl-submit"><span class="cmd">curl</span> <span class="flag">-X POST</span> \
  <span class="url">"https://rmhazuregeoapi.../api/jobs/submit/process_raster_v2"</span> \
  <span class="flag">-H</span> <span class="string">"Content-Type: application/json"</span> \
  <span class="flag">-d</span> '{
    <span class="key">"source_container"</span>: <span class="string">""</span>,
    <span class="key">"source_blob"</span>: <span class="string">""</span>,
    <span class="key">"collection_id"</span>: <span class="string">""</span>,
    <span class="key">"item_id"</span>: <span class="string">""</span>,
    <span class="key">"output_format"</span>: <span class="string">"COG"</span>,
    <span class="key">"compression"</span>: <span class="string">"LZW"</span>,
    <span class="key">"target_crs"</span>: <span class="string">"EPSG:4326"</span>
  }'</pre>
                </div>
            </div>
        </div>

        <!-- Workflow Connector -->
        <div class="workflow-connector">
            <div class="workflow-arrow">Response contains job_id</div>
        </div>

        <!-- BLOCK 2: Job Monitoring -->
        <div class="block-row">
            <div class="block-header">
                <div class="block-number">2</div>
                <div class="block-title">Monitor Job Progress</div>
                <div class="block-subtitle">Poll until status = "completed"</div>
            </div>
            <div class="block-content">
                <!-- Left: Mini Monitor -->
                <div class="monitor-mini">
                    <div class="job-status-bar">
                        <span class="job-id-display" id="job-id-display">(submit job to see ID)</span>
                        <span class="status-badge processing" id="status-badge">PROCESSING</span>
                    </div>

                    <div class="stages-mini">
                        <div class="stage-mini completed" id="stage-1">
                            <div class="stage-mini-number">Stage 1</div>
                            <div class="stage-mini-name">Validate</div>
                            <div class="stage-mini-status">1/1 tasks</div>
                        </div>
                        <div class="stage-mini active" id="stage-2">
                            <div class="stage-mini-number">Stage 2</div>
                            <div class="stage-mini-name">Process</div>
                            <div class="stage-mini-status">0/1 tasks</div>
                        </div>
                        <div class="stage-mini" id="stage-3">
                            <div class="stage-mini-number">Stage 3</div>
                            <div class="stage-mini-name">Register</div>
                            <div class="stage-mini-status">pending</div>
                        </div>
                    </div>
                </div>

                <!-- Right: CURL Examples -->
                <div class="curl-section">
                    <div class="curl-header">
                        <span class="curl-label">CURL - Check Job Status</span>
                        <button class="copy-btn" onclick="copyCurl('curl-status')">Copy</button>
                    </div>
                    <pre class="curl-code" id="curl-status"><span class="cmd">curl</span> <span class="url">"https://rmhazuregeoapi.../api/jobs/status/<span id="curl-job-id-1">{job_id}</span>"</span>

<span style="color:#888"># Response:</span>
{
  <span class="key">"job_id"</span>: <span class="string">"abc123..."</span>,
  <span class="key">"status"</span>: <span class="string">"processing"</span>,
  <span class="key">"stage"</span>: <span class="number">2</span>,
  <span class="key">"total_stages"</span>: <span class="number">3</span>,
  <span class="key">"progress_pct"</span>: <span class="number">66</span>
}</pre>
                </div>
            </div>
        </div>

        <!-- Workflow Connector -->
        <div class="workflow-connector">
            <div class="workflow-arrow">When status = "completed"</div>
        </div>

        <!-- BLOCK 3: Output Data -->
        <div class="block-row">
            <div class="block-header">
                <div class="block-number">3</div>
                <div class="block-title">Retrieve Output Data</div>
                <div class="block-subtitle">GET /api/jobs/status/{job_id} (completed)</div>
            </div>
            <div class="block-content">
                <!-- Left: JSON Output -->
                <div class="output-section">
                    <div class="json-display">
{
  <span class="key">"job_id"</span>: <span class="string">"a1b2c3d4e5f6..."</span>,
  <span class="key">"status"</span>: <span class="string">"completed"</span>,
  <span class="key">"job_type"</span>: <span class="string">"process_raster_v2"</span>,
  <span class="key">"result_data"</span>: {
    <span class="key">"cog"</span>: {
      <span class="key highlight highlight-url">"output_url"</span>: <span class="string highlight highlight-url">"https://rmhazuregeosilver.blob.../silver-cogs/flood_depth_100yr.tif"</span>,
      <span class="key">"size_bytes"</span>: <span class="number">15234567</span>,
      <span class="key">"compression"</span>: <span class="string">"LZW"</span>
    },
    <span class="key">"stac"</span>: {
      <span class="key highlight highlight-ddh">"collection_id"</span>: <span class="string highlight highlight-ddh">"flood-risk-2024"</span>,
      <span class="key highlight highlight-ddh">"item_id"</span>: <span class="string highlight highlight-ddh">"depth-100yr-northeast"</span>,
      <span class="key highlight highlight-url">"item_url"</span>: <span class="string highlight highlight-url">"https://rmhazuregeoapi.../api/stac/collections/flood-risk-2024/items/depth-100yr-northeast"</span>
    },
    <span class="key">"metadata"</span>: {
      <span class="key">"bbox"</span>: [<span class="number">-74.5</span>, <span class="number">40.2</span>, <span class="number">-73.7</span>, <span class="number">41.1</span>],
      <span class="key">"crs"</span>: <span class="string">"EPSG:4326"</span>,
      <span class="key">"resolution"</span>: <span class="number">10.0</span>
    }
  }
}</div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color url"></div>
                            <span>Output URLs (for data access)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color ddh"></div>
                            <span>DDH Identifiers (for cataloging)</span>
                        </div>
                    </div>
                </div>

                <!-- Right: CURL -->
                <div class="curl-section">
                    <div class="curl-header">
                        <span class="curl-label">CURL - Get Completed Job</span>
                        <button class="copy-btn" onclick="copyCurl('curl-result')">Copy</button>
                    </div>
                    <pre class="curl-code" id="curl-result"><span class="cmd">curl</span> <span class="url">"https://rmhazuregeoapi.../api/jobs/status/<span id="curl-job-id-2">{job_id}</span>"</span>

<span style="color:#888"># Extract COG URL:</span>
<span class="cmd">curl</span> <span class="url">"...api/jobs/status/{job_id}"</span> | \
  <span class="cmd">jq</span> <span class="string">'.result_data.cog.output_url'</span>

<span style="color:#888"># Fetch STAC Item directly:</span>
<span class="cmd">curl</span> <span class="url">"https://rmhazuregeoapi.../api/stac/collections/<span id="curl-collection-id">{collection_id}</span>/items/<span id="curl-item-id">{item_id}</span>"</span></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let selectedFile = '';
        let currentJobId = '';

        function selectFile(element, filename) {
            document.querySelectorAll('.file-item').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedFile = filename;
            updateCurl();
        }

        function updateCurl() {
            const container = document.getElementById('container-select').value;
            const collectionId = document.getElementById('collection-id').value;
            const itemId = document.getElementById('item-id').value;
            const outputFormat = document.getElementById('output-format').value;
            const compression = document.getElementById('compression').value;
            const targetCrs = document.getElementById('target-crs').value;

            const curlHtml = `<span class="cmd">curl</span> <span class="flag">-X POST</span> \\
  <span class="url">"https://rmhazuregeoapi.../api/jobs/submit/process_raster_v2"</span> \\
  <span class="flag">-H</span> <span class="string">"Content-Type: application/json"</span> \\
  <span class="flag">-d</span> '{
    <span class="key">"source_container"</span>: <span class="string">"${container}"</span>,
    <span class="key">"source_blob"</span>: <span class="string">"${selectedFile}"</span>,
    <span class="key">"collection_id"</span>: <span class="string">"${collectionId}"</span>,
    <span class="key">"item_id"</span>: <span class="string">"${itemId}"</span>,
    <span class="key">"output_format"</span>: <span class="string">"${outputFormat}"</span>,
    <span class="key">"compression"</span>: <span class="string">"${compression}"</span>,
    <span class="key">"target_crs"</span>: <span class="string">"${targetCrs}"</span>
  }'`;

            document.getElementById('curl-submit').innerHTML = curlHtml;

            // Update Block 3 CURL with collection/item IDs
            if (collectionId) {
                document.getElementById('curl-collection-id').textContent = collectionId;
            }
            if (itemId) {
                document.getElementById('curl-item-id').textContent = itemId;
            }
        }

        function simulateSubmit() {
            // Generate a fake job ID for demo
            currentJobId = 'a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6';

            // Update displays
            document.getElementById('job-id-display').textContent = currentJobId.substring(0, 16) + '...';
            document.getElementById('job-id-display').classList.remove('placeholder');

            // Update CURL job IDs in Block 2 and 3
            document.getElementById('curl-job-id-1').textContent = currentJobId.substring(0, 16) + '...';
            document.getElementById('curl-job-id-2').textContent = currentJobId.substring(0, 16) + '...';

            // Simulate progress
            simulateProgress();
        }

        function simulateProgress() {
            const stages = ['stage-1', 'stage-2', 'stage-3'];
            let currentStage = 0;

            const interval = setInterval(() => {
                if (currentStage > 0) {
                    document.getElementById(stages[currentStage - 1]).classList.remove('active');
                    document.getElementById(stages[currentStage - 1]).classList.add('completed');
                }

                if (currentStage < stages.length) {
                    document.getElementById(stages[currentStage]).classList.add('active');
                    currentStage++;
                } else {
                    clearInterval(interval);
                    document.getElementById('status-badge').textContent = 'COMPLETED';
                    document.getElementById('status-badge').className = 'status-badge completed';
                }
            }, 1500);
        }

        function copyCurl(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.parentElement.querySelector('.copy-btn');
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            });
        }
    </script>
</body>
</html>
