{
  "openapi": "3.0.1",
  "info": {
    "title": "Geospatial Platform API",
    "version": "1.3.0",
    "description": "**B2B Integration API for DDH (Data Hub)**\n\nThis API provides endpoints for automated data onboarding, processing status, and catalog verification.\n\n## Endpoint Categories\n\n### Platform - Data Onboarding\n- Submit vector/raster data for processing\n- Monitor job status and failures\n- Unpublish/delete data\n\n### Approvals - QA Workflow\n- Review pending datasets before publication\n- Approve or reject with audit trail\n\n### Catalog - STAC Verification\n- Verify processed data exists in catalog\n- Get asset URLs for downstream consumption\n\n**Note:** B2C data query endpoints (OGC Features, tile serving, point queries) are provided by the TiTiler service.\n",
    "contact": {
      "name": "Geospatial Platform Team",
      "email": "platform-support@example.com"
    },
    "license": {
      "name": "Proprietary"
    }
  },
  "servers": [
    {
      "url": "https://rmhazuregeoapi-a3dma3ctfdgngwf6.eastus-01.azurewebsites.net",
      "description": "Azure Functions backend (development)"
    }
  ],
  "tags": [
    {
      "name": "Platform",
      "description": "Data onboarding endpoints for DDH integration.\nSubmit data, monitor processing, and manage lifecycle.\n"
    },
    {
      "name": "Approvals",
      "description": "Dataset approval workflow for QA before publishing.\nReview, approve, or reject datasets with audit trail.\n"
    },
    {
      "name": "Catalog",
      "description": "STAC catalog verification for processed data.\nLookup items by DDH identifiers, verify assets exist.\n"
    }
  ],
  "paths": {
    "/api/platform/submit": {
      "post": {
        "summary": "Submit data for processing",
        "description": "Submit a data processing request using DDH identifiers.\nAutomatically detects data type (vector/raster) and routes to appropriate job.\n\n**Idempotent:** Request ID = SHA256(dataset_id + resource_id + version_id)\n",
        "operationId": "platformSubmit",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Request accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          }
        }
      }
    },
    "/api/platform/raster": {
      "post": {
        "summary": "Submit single raster",
        "description": "Submit a single raster file for COG conversion and STAC cataloging.\n\n**Routes to:** process_raster_v2 (or process_large_raster_v2 for large files)",
        "operationId": "platformRaster",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRasterRequest"
              },
              "example": {
                "dataset_id": "aerial-imagery-2024",
                "resource_id": "site-alpha",
                "version_id": "v1.0",
                "container_name": "bronze-rasters",
                "file_name": "aerial-alpha.tif",
                "service_name": "Aerial Imagery Site Alpha"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (e.g., file_name is a list)"
          }
        }
      }
    },
    "/api/platform/raster-collection": {
      "post": {
        "summary": "Submit raster collection",
        "description": "Submit multiple raster files as a collection.\nCreates MosaicJSON for seamless tile access.\n\n**Minimum:** 2 files required",
        "operationId": "platformRasterCollection",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRasterCollectionRequest"
              },
              "example": {
                "dataset_id": "aerial-tiles-2024",
                "resource_id": "site-alpha",
                "version_id": "v1.0",
                "container_name": "bronze-rasters",
                "file_name": ["tile1.tif", "tile2.tif", "tile3.tif"],
                "service_name": "Aerial Tiles Site Alpha"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (e.g., file_name is not a list or has <2 files)"
          }
        }
      }
    },
    "/api/platform/status/{request_id}": {
      "get": {
        "summary": "Get request status",
        "description": "Get status of a platform request by request_id.\nIncludes DDH identifiers, job progress, and data access URLs when complete.",
        "operationId": "platformStatus",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "verbose",
            "in": "query",
            "description": "Include detailed task information",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Request status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformStatusResponse"
                }
              }
            }
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/status": {
      "get": {
        "summary": "List platform requests",
        "description": "List platform requests with optional filtering.",
        "operationId": "platformStatusList",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 100
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "processing", "completed", "failed"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of platform requests"
          }
        }
      }
    },
    "/api/platform/jobs/{job_id}/status": {
      "get": {
        "summary": "Get job status by job_id",
        "description": "Get status of a CoreMachine job directly by job_id.\nUseful when only job_id is available (from webhook callbacks, etc.).",
        "operationId": "platformJobStatus",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "verbose",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Job status with task summary",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformJobStatus"
                }
              }
            }
          },
          "404": {
            "description": "Job not found"
          }
        }
      }
    },
    "/api/platform/health": {
      "get": {
        "summary": "Platform health check",
        "description": "System readiness check for DDH integration.\nReturns job processing status without exposing internal details.",
        "operationId": "platformHealth",
        "tags": ["Platform"],
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/platform/failures": {
      "get": {
        "summary": "Recent failures",
        "description": "Get recent failures with sanitized error summaries.\nNo internal paths, secrets, or stack traces exposed.",
        "operationId": "platformFailures",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "hours",
            "in": "query",
            "description": "Lookback period in hours",
            "schema": {
              "type": "integer",
              "default": 24
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Failure patterns and recent failures"
          }
        }
      }
    },
    "/api/platform/validate": {
      "post": {
        "summary": "Pre-flight validation",
        "description": "Validate a file exists before submitting.\nReturns file size, recommended job type, and processing estimates.",
        "operationId": "platformValidate",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["data_type", "container_name", "blob_name"],
                "properties": {
                  "data_type": {
                    "type": "string",
                    "enum": ["raster", "vector"]
                  },
                  "container_name": {
                    "type": "string"
                  },
                  "blob_name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation result with recommendations"
          },
          "404": {
            "description": "File not found"
          }
        }
      }
    },
    "/api/platform/lineage/{request_id}": {
      "get": {
        "summary": "Data lineage trace",
        "description": "Get data lineage trace for a platform request.\nReturns source → processing → output lineage.",
        "operationId": "platformLineage",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Data lineage information"
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/unpublish/vector": {
      "post": {
        "summary": "Unpublish vector data",
        "description": "Remove vector data from the platform.\nDrops PostGIS table, deletes metadata, and optionally removes STAC item.\n\n**Identification Options:**\n- DDH identifiers (dataset_id, resource_id, version_id)\n- request_id from original submission\n- Direct table_name (cleanup mode)\n\n**Note:** dry_run=true by default (preview mode)",
        "operationId": "platformUnpublishVector",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnpublishVectorRequest"
              },
              "examples": {
                "by_ddh_ids": {
                  "summary": "By DDH Identifiers",
                  "value": {
                    "dataset_id": "parcels-2024",
                    "resource_id": "downtown",
                    "version_id": "v1.0",
                    "dry_run": true
                  }
                },
                "by_request_id": {
                  "summary": "By Request ID",
                  "value": {
                    "request_id": "a3f2c1b8e9d7f6a5...",
                    "dry_run": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Unpublish result (dry_run shows what would be deleted)"
          },
          "404": {
            "description": "Data not found"
          }
        }
      }
    },
    "/api/platform/unpublish/raster": {
      "post": {
        "summary": "Unpublish raster data",
        "description": "Remove raster data from the platform.\nDeletes STAC item and associated COG/MosaicJSON blobs from storage.\n\n**Identification Options:**\n- DDH identifiers (dataset_id, resource_id, version_id)\n- request_id from original submission\n- Direct STAC identifiers (cleanup mode)\n\n**Note:** dry_run=true by default (preview mode)",
        "operationId": "platformUnpublishRaster",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnpublishRasterRequest"
              },
              "examples": {
                "by_ddh_ids": {
                  "summary": "By DDH Identifiers",
                  "value": {
                    "dataset_id": "aerial-imagery-2024",
                    "resource_id": "site-alpha",
                    "version_id": "v1.0",
                    "dry_run": true
                  }
                },
                "by_request_id": {
                  "summary": "By Request ID",
                  "value": {
                    "request_id": "b4e5d6c7...",
                    "dry_run": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Unpublish result (dry_run shows what would be deleted)"
          },
          "404": {
            "description": "Data not found"
          }
        }
      }
    },
    "/api/platform/catalog/lookup": {
      "get": {
        "summary": "Lookup catalog item by DDH identifiers",
        "description": "Verify a STAC item exists for DDH identifiers.\nReturns item metadata and asset URLs if found.\n\n**Use case:** Verify processing completed and get access URLs.",
        "operationId": "catalogLookup",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "dataset_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "resource_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Catalog item found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogLookupResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found for given identifiers"
          }
        }
      }
    },
    "/api/platform/catalog/item/{collection_id}/{item_id}": {
      "get": {
        "summary": "Get catalog item details",
        "description": "Get full STAC item details including all assets.\nRestricted to items created via Platform (B2B access only).",
        "operationId": "catalogItem",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "collection_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "item_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "STAC item details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogItemResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found"
          }
        }
      }
    },
    "/api/platform/catalog/assets/{collection_id}/{item_id}": {
      "get": {
        "summary": "Get asset URLs for item",
        "description": "Get direct access URLs for all assets in a STAC item.\nReturns COG URLs, MosaicJSON URLs, and any thumbnails.\n\n**Use case:** Get URLs to pass to TiTiler or data clients.",
        "operationId": "catalogAssets",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "collection_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "item_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Asset URLs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogAssetsResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found"
          }
        }
      }
    },
    "/api/platform/catalog/dataset/{dataset_id}": {
      "get": {
        "summary": "List items for DDH dataset",
        "description": "List all STAC items for a DDH dataset identifier.\nReturns all items that have the specified platform:dataset_id.",
        "operationId": "catalogDataset",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "dataset_id",
            "in": "path",
            "required": true,
            "description": "DDH dataset identifier",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum items to return",
            "schema": {
              "type": "integer",
              "default": 100,
              "maximum": 1000
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of STAC items",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dataset_id": {
                      "type": "string",
                      "description": "DDH dataset identifier"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of items returned"
                    },
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "item_id": {"type": "string"},
                          "collection_id": {"type": "string"},
                          "bbox": {"type": "array", "items": {"type": "number"}},
                          "datetime": {"type": "string", "format": "date-time"},
                          "resource_id": {"type": "string"},
                          "version_id": {"type": "string"}
                        }
                      }
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                },
                "example": {
                  "dataset_id": "flood-hazard-data",
                  "count": 3,
                  "items": [
                    {
                      "item_id": "flood-v1.0-res001",
                      "collection_id": "flood-hazard-2024",
                      "bbox": [-75.5, -56.5, -66.5, -49.0],
                      "datetime": "2026-01-15T00:00:00Z",
                      "resource_id": "res-001",
                      "version_id": "v1.0"
                    }
                  ],
                  "timestamp": "2026-01-16T10:00:00Z"
                }
              }
            }
          }
        }
      }
    },
    "/api/approvals": {
      "get": {
        "summary": "List dataset approvals",
        "description": "List dataset approvals with optional filtering.\n\n**Query Parameters:**\n- `status`: Filter by status (pending, approved, rejected)\n- `limit`: Max results (default: 50)",
        "operationId": "approvalsList",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "description": "Filter by approval status",
            "schema": {
              "type": "string",
              "enum": ["pending", "approved", "rejected"]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 50
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of approvals",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalList"
                }
              }
            }
          }
        }
      }
    },
    "/api/approvals/{approval_id}": {
      "get": {
        "summary": "Get approval details",
        "description": "Get details of a specific dataset approval.",
        "operationId": "approvalsGet",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Approval details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DatasetApproval"
                }
              }
            }
          },
          "404": {
            "description": "Approval not found"
          }
        }
      }
    },
    "/api/approvals/{approval_id}/approve": {
      "post": {
        "summary": "Approve dataset",
        "description": "Approve a dataset for publishing.\nUpdates STAC item with published=true.",
        "operationId": "approvalsApprove",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalAction"
              },
              "example": {
                "reviewer": "user@example.com",
                "notes": "Reviewed and approved for publication"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dataset approved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DatasetApproval"
                }
              }
            }
          }
        }
      }
    },
    "/api/approvals/{approval_id}/reject": {
      "post": {
        "summary": "Reject dataset",
        "description": "Reject a dataset with required reason.",
        "operationId": "approvalsReject",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RejectionAction"
              },
              "example": {
                "reviewer": "user@example.com",
                "reason": "Data quality issues - missing attribute values"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dataset rejected",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DatasetApproval"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PlatformRequest": {
        "type": "object",
        "required": ["dataset_id", "resource_id", "version_id", "container_name", "file_name", "service_name"],
        "properties": {
          "dataset_id": {
            "type": "string",
            "maxLength": 255,
            "description": "DDH dataset identifier"
          },
          "resource_id": {
            "type": "string",
            "maxLength": 255,
            "description": "DDH resource identifier"
          },
          "version_id": {
            "type": "string",
            "maxLength": 50,
            "description": "DDH version identifier"
          },
          "operation": {
            "type": "string",
            "enum": ["CREATE", "UPDATE", "DELETE"],
            "default": "CREATE"
          },
          "container_name": {
            "type": "string",
            "description": "Azure storage container name"
          },
          "file_name": {
            "oneOf": [
              {"type": "string"},
              {"type": "array", "items": {"type": "string"}}
            ],
            "description": "File name(s) - single string or array for raster collections"
          },
          "service_name": {
            "type": "string",
            "description": "Human-readable service name"
          },
          "access_level": {
            "type": "string",
            "enum": ["public", "OUO", "restricted"],
            "default": "OUO",
            "description": "Data classification level"
          },
          "description": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {"type": "string"}
          },
          "processing_options": {
            "type": "object",
            "additionalProperties": true,
            "description": "Processing options (crs, nodata_value, overwrite, etc.)"
          }
        }
      },
      "PlatformRasterRequest": {
        "type": "object",
        "required": ["dataset_id", "resource_id", "container_name", "file_name"],
        "properties": {
          "dataset_id": {
            "type": "string",
            "description": "DDH dataset identifier"
          },
          "resource_id": {
            "type": "string",
            "description": "DDH resource identifier"
          },
          "version_id": {
            "type": "string",
            "description": "Version identifier (optional)"
          },
          "container_name": {
            "type": "string",
            "description": "Azure Blob Storage container"
          },
          "file_name": {
            "type": "string",
            "description": "Single file name (not a list)"
          },
          "service_name": {
            "type": "string",
            "description": "Human-readable service name"
          }
        }
      },
      "PlatformRasterCollectionRequest": {
        "type": "object",
        "required": ["dataset_id", "resource_id", "container_name", "file_name"],
        "properties": {
          "dataset_id": {
            "type": "string",
            "description": "DDH dataset identifier"
          },
          "resource_id": {
            "type": "string",
            "description": "DDH resource identifier"
          },
          "version_id": {
            "type": "string",
            "description": "Version identifier (optional)"
          },
          "container_name": {
            "type": "string",
            "description": "Azure Blob Storage container"
          },
          "file_name": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 2,
            "description": "List of file names (must have at least 2 files)"
          },
          "service_name": {
            "type": "string",
            "description": "Human-readable service name"
          }
        }
      },
      "PlatformResponse": {
        "type": "object",
        "properties": {
          "request_id": {
            "type": "string",
            "description": "Idempotent request ID (SHA256 of DDH identifiers)"
          },
          "job_id": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "monitor_url": {
            "type": "string",
            "description": "URL to check request status"
          }
        }
      },
      "PlatformStatusResponse": {
        "type": "object",
        "properties": {
          "request_id": {
            "type": "string"
          },
          "dataset_id": {
            "type": "string"
          },
          "resource_id": {
            "type": "string"
          },
          "version_id": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "job_status": {
            "type": "string",
            "enum": ["queued", "processing", "completed", "failed"]
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "completed_at": {
            "type": "string",
            "format": "date-time"
          },
          "task_summary": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "completed": {"type": "integer"},
              "failed": {"type": "integer"}
            }
          },
          "data_access": {
            "type": "object",
            "description": "Access URLs when job is complete",
            "properties": {
              "stac_collection_id": {"type": "string"},
              "stac_item_id": {"type": "string"},
              "ogc_features_url": {"type": "string"},
              "cog_url": {"type": "string"}
            }
          }
        }
      },
      "PlatformJobStatus": {
        "type": "object",
        "properties": {
          "job_id": {
            "type": "string"
          },
          "job_type": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["queued", "processing", "completed", "failed", "completed_with_errors"]
          },
          "stage": {
            "type": "integer"
          },
          "total_stages": {
            "type": "integer"
          },
          "task_summary": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "completed": {"type": "integer"},
              "failed": {"type": "integer"},
              "pending": {"type": "integer"}
            }
          },
          "result_data": {
            "type": "object",
            "description": "Job results (when completed)"
          }
        }
      },
      "UnpublishVectorRequest": {
        "type": "object",
        "properties": {
          "dataset_id": {
            "type": "string",
            "description": "DDH dataset identifier (Option 1)"
          },
          "resource_id": {
            "type": "string",
            "description": "DDH resource identifier (Option 1)"
          },
          "version_id": {
            "type": "string",
            "description": "Version identifier (Option 1)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (Option 2)"
          },
          "table_name": {
            "type": "string",
            "description": "Direct table name for cleanup mode (Option 3)"
          },
          "dry_run": {
            "type": "boolean",
            "default": true,
            "description": "Preview mode - no deletions (default: true)"
          }
        }
      },
      "UnpublishRasterRequest": {
        "type": "object",
        "properties": {
          "dataset_id": {
            "type": "string",
            "description": "DDH dataset identifier (Option 1)"
          },
          "resource_id": {
            "type": "string",
            "description": "DDH resource identifier (Option 1)"
          },
          "version_id": {
            "type": "string",
            "description": "Version identifier (Option 1)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (Option 2)"
          },
          "stac_item_id": {
            "type": "string",
            "description": "STAC item ID for cleanup mode (Option 3)"
          },
          "collection_id": {
            "type": "string",
            "description": "STAC collection ID for cleanup mode (Option 3)"
          },
          "dry_run": {
            "type": "boolean",
            "default": true,
            "description": "Preview mode - no deletions (default: true)"
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy", "degraded", "unhealthy"]
          },
          "ready_for_jobs": {
            "type": "boolean"
          },
          "components": {
            "type": "object",
            "properties": {
              "database": {"type": "string"},
              "storage": {"type": "string"},
              "service_bus": {"type": "string"}
            }
          },
          "version": {
            "type": "string"
          }
        }
      },
      "CatalogLookupResponse": {
        "type": "object",
        "properties": {
          "found": {
            "type": "boolean"
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"]
          },
          "collection_id": {
            "type": "string"
          },
          "item_id": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "access_urls": {
            "type": "object",
            "properties": {
              "cog_url": {"type": "string"},
              "mosaic_url": {"type": "string"},
              "ogc_features_url": {"type": "string"},
              "stac_item_url": {"type": "string"}
            }
          }
        }
      },
      "CatalogItemResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["Feature"]
          },
          "stac_version": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "collection": {
            "type": "string"
          },
          "geometry": {
            "type": "object"
          },
          "bbox": {
            "type": "array",
            "items": {"type": "number"}
          },
          "properties": {
            "type": "object",
            "additionalProperties": true
          },
          "assets": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/CatalogAsset"
            }
          }
        }
      },
      "CatalogAsset": {
        "type": "object",
        "properties": {
          "href": {
            "type": "string",
            "format": "uri"
          },
          "type": {
            "type": "string",
            "description": "MIME type (e.g., image/tiff; application=geotiff)"
          },
          "title": {
            "type": "string"
          },
          "roles": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      },
      "CatalogAssetsResponse": {
        "type": "object",
        "properties": {
          "collection_id": {
            "type": "string"
          },
          "item_id": {
            "type": "string"
          },
          "assets": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "href": {"type": "string"},
                "type": {"type": "string"},
                "role": {"type": "string"}
              }
            }
          },
          "titiler_urls": {
            "type": "object",
            "description": "Pre-built TiTiler URLs for common operations",
            "properties": {
              "tiles": {"type": "string"},
              "preview": {"type": "string"},
              "info": {"type": "string"}
            }
          }
        }
      },
      "ApprovalList": {
        "type": "object",
        "properties": {
          "approvals": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DatasetApproval"
            }
          },
          "count": {
            "type": "integer"
          }
        }
      },
      "DatasetApproval": {
        "type": "object",
        "properties": {
          "approval_id": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "job_type": {
            "type": "string"
          },
          "classification": {
            "type": "string",
            "enum": ["public", "ouo"]
          },
          "status": {
            "type": "string",
            "enum": ["pending", "approved", "rejected"]
          },
          "stac_item_id": {
            "type": "string"
          },
          "stac_collection_id": {
            "type": "string"
          },
          "reviewer": {
            "type": "string"
          },
          "notes": {
            "type": "string"
          },
          "rejection_reason": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "reviewed_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApprovalAction": {
        "type": "object",
        "required": ["reviewer"],
        "properties": {
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer"
          },
          "notes": {
            "type": "string",
            "description": "Optional approval notes"
          }
        }
      },
      "RejectionAction": {
        "type": "object",
        "required": ["reviewer", "reason"],
        "properties": {
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer"
          },
          "reason": {
            "type": "string",
            "description": "Required rejection reason"
          }
        }
      }
    }
  }
}
