{
  "openapi": "3.0.1",
  "info": {
    "title": "Geospatial Platform API",
    "version": "0.8",
    "description": "**B2B Integration API for DDH (Data Hub)**\n\nThis API provides endpoints for automated data onboarding, processing status, and catalog verification.\n\n## What's New in v0.8 (02 FEB 2026)\n\n- **Version Lineage**: Track data versions with `previous_version_id`\n- **Dry Run Validation**: `?dry_run=true` validates without creating jobs\n- **Three-State Entity Model**: processing_status, approval_state, clearance_state\n- **Unified Unpublish**: Single endpoint replaces separate vector/raster\n- **Reject/Revoke/Resubmit**: Complete approval lifecycle management\n- **Platform Registry**: List registered B2B platforms\n\n## Endpoint Categories\n\n### Platform - Data Onboarding\n- Submit vector/raster data with version lineage\n- Validate requests before submission (dry_run)\n- Monitor job status and failures\n- Unpublish/resubmit data\n\n### Approvals - QA Workflow\n- Review pending datasets before publication\n- Approve, reject, or revoke with audit trail\n- Batch approval status queries\n\n### Catalog - STAC Verification\n- Verify processed data exists in catalog\n- Get asset URLs for downstream consumption\n- Query by DDH identifiers or STAC IDs\n\n**Note:** B2C data query endpoints (OGC Features, tile serving, point queries) are provided by the TiTiler service.\n",
    "contact": {
      "name": "Geospatial Platform Team",
      "email": "platform-support@example.com"
    },
    "license": {
      "name": "Proprietary"
    }
  },
  "servers": [
    {
      "url": "https://rmhazuregeoapi-a3dma3ctfdgngwf6.eastus-01.azurewebsites.net",
      "description": "Azure Functions backend (development)"
    }
  ],
  "tags": [
    {
      "name": "Platform",
      "description": "Data onboarding endpoints for DDH integration.\nSubmit data, monitor processing, and manage lifecycle.\n"
    },
    {
      "name": "Approvals",
      "description": "Dataset approval workflow for QA before publishing.\nReview, approve, or reject datasets with audit trail.\n"
    },
    {
      "name": "Catalog",
      "description": "STAC catalog verification for processed data.\nLookup items by DDH identifiers, verify assets exist.\n"
    }
  ],
  "paths": {
    "/api/platform/submit": {
      "post": {
        "summary": "Submit data for processing",
        "description": "Submit a data processing request using DDH identifiers.\n\n**Key Features:**\n- Automatic data type detection (vector/raster)\n- Version lineage support via `previous_version_id`\n- Dry run validation with `?dry_run=true`\n- Idempotent: Request ID = SHA256(dataset_id + resource_id + version_id)\n\n**Dry Run Mode:**\nWhen `dry_run=true`, validates the request and returns:\n- `lineage_state`: Current version chain information\n- `suggested_params`: Recommended parameters based on source file\n- No job is created\n\n**Version Lineage:**\nInclude `previous_version_id` to link this version to a prior version.\nThe system tracks the complete version chain for audit and rollback.\n",
        "operationId": "platformSubmit",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "dry_run",
            "in": "query",
            "description": "Validate request without creating a job. Returns lineage_state and suggested_params.",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRequest"
              },
              "examples": {
                "newVersion": {
                  "summary": "New version with lineage",
                  "value": {
                    "dataset_id": "aerial-imagery-2024",
                    "resource_id": "site-alpha",
                    "version_id": "v2.0",
                    "previous_version_id": "abc123def456...",
                    "container_name": "bronze-rasters",
                    "file_name": "aerial-alpha-v2.tif",
                    "title": "Aerial Imagery Site Alpha v2"
                  }
                },
                "dryRunValidation": {
                  "summary": "Dry run validation",
                  "description": "Add ?dry_run=true to validate without creating job",
                  "value": {
                    "dataset_id": "test-dataset",
                    "resource_id": "test-resource",
                    "version_id": "v1.0",
                    "container_name": "bronze-rasters",
                    "file_name": "test.tif"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dry run validation result (when dry_run=true)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DryRunResponse"
                }
              }
            }
          },
          "202": {
            "description": "Request accepted for processing",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          }
        }
      }
    },
    "/api/platform/status/{request_id}": {
      "get": {
        "summary": "Get request status",
        "description": "Get status of a platform request.\n\n**IMPORTANT:** Use `request_id` as the primary identifier. The `request_id` is returned from `/api/platform/submit` and is deterministic (SHA256 of DDH identifiers).\n\n**Backward Compatibility:**\nThis endpoint also accepts `job_id` or `asset_id` and auto-detects the ID type. However, `request_id` is preferred because:\n- It's stable and deterministic\n- It maps directly to DDH identifiers\n- It survives job recreation (e.g., resubmit after rejection)\n\nIncludes DDH identifiers, job progress, and data access URLs when complete.",
        "operationId": "platformStatus",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "description": "Platform request ID (preferred), job ID, or asset ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "verbose",
            "in": "query",
            "description": "Include detailed task information",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Request status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformStatusResponse"
                }
              }
            }
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/status": {
      "get": {
        "summary": "List platform requests",
        "description": "List platform requests with optional filtering.",
        "operationId": "platformStatusList",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 100
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "processing", "completed", "failed"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of platform requests"
          }
        }
      }
    },
    "/api/platform/health": {
      "get": {
        "summary": "Platform health check",
        "description": "System readiness check for DDH integration.\nReturns job processing status without exposing internal details.",
        "operationId": "platformHealth",
        "tags": ["Platform"],
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/platform/failures": {
      "get": {
        "summary": "Recent failures",
        "description": "Get recent failures with sanitized error summaries.\nNo internal paths, secrets, or stack traces exposed.",
        "operationId": "platformFailures",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "hours",
            "in": "query",
            "description": "Lookback period in hours",
            "schema": {
              "type": "integer",
              "default": 24
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Failure patterns and recent failures"
          }
        }
      }
    },
    "/api/platform/validate": {
      "post": {
        "summary": "Pre-flight validation",
        "description": "Validate a file exists before submitting.\nReturns file size, recommended job type, and processing estimates.",
        "operationId": "platformValidate",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["data_type", "container_name", "blob_name"],
                "properties": {
                  "data_type": {
                    "type": "string",
                    "enum": ["raster", "vector"]
                  },
                  "container_name": {
                    "type": "string"
                  },
                  "blob_name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation result with recommendations"
          },
          "404": {
            "description": "File not found"
          }
        }
      }
    },
    "/api/platform/lineage/{request_id}": {
      "get": {
        "summary": "Data lineage trace",
        "description": "Get data lineage trace for a platform request.\nReturns source → processing → output lineage.",
        "operationId": "platformLineage",
        "tags": ["Platform"],
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Data lineage information"
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/unpublish": {
      "post": {
        "summary": "Unpublish data (unified)",
        "description": "Remove data from the platform (vector or raster).\nAutomatically determines data type and handles appropriate cleanup.\n\n**Identification Options:**\n- DDH identifiers (dataset_id, resource_id, version_id)\n- request_id from original submission\n\n**Actions Performed:**\n- Vector: Drops PostGIS table, deletes metadata, removes STAC item\n- Raster: Deletes COG/MosaicJSON blobs, removes STAC item\n\n**Note:** dry_run=true by default (preview mode)",
        "operationId": "platformUnpublish",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnpublishRequest"
              },
              "examples": {
                "by_ddh_ids": {
                  "summary": "By DDH Identifiers",
                  "value": {
                    "dataset_id": "aerial-imagery-2024",
                    "resource_id": "site-alpha",
                    "version_id": "v1.0",
                    "dry_run": true
                  }
                },
                "by_request_id": {
                  "summary": "By Request ID",
                  "value": {
                    "request_id": "a3f2c1b8e9d7f6a5...",
                    "dry_run": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Unpublish result (dry_run shows what would be deleted)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnpublishResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found"
          }
        }
      }
    },
    "/api/platform/approve": {
      "post": {
        "summary": "Approve a dataset for publication",
        "description": "Approve a dataset for publication. Updates GeospatialAsset.approval_state to APPROVED and STAC item with app:published=true.\n\n**Identification Options (in order of preference):**\n- `asset_id`: GeospatialAsset ID (preferred)\n- `stac_item_id`: STAC item ID\n- `job_id`: CoreMachine job ID\n- `request_id`: Platform request ID\n\n**Clearance Levels:**\n- `ouo`: Official Use Only - internal access, no external export\n- `public`: Public access - triggers ADF pipeline for external zone export\n\n**Note:** The `asset_id` is the primary identifier in v0.8. Use `request_id` for backward compatibility.",
        "operationId": "platformApprove",
        "tags": ["Approvals"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformApproveRequest"
              },
              "examples": {
                "byAssetId": {
                  "summary": "By Asset ID (preferred)",
                  "value": {
                    "asset_id": "abc123def456...",
                    "reviewer": "user@example.com",
                    "clearance_level": "ouo",
                    "notes": "Reviewed and approved for internal use"
                  }
                },
                "byRequestId": {
                  "summary": "By Request ID (backward compatibility)",
                  "value": {
                    "request_id": "a3f2c1b8e9d7f6a5...",
                    "reviewer": "user@example.com",
                    "clearance_level": "public",
                    "notes": "Approved for public release"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dataset approved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformApprovalResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (reviewer and clearance_level required)"
          },
          "404": {
            "description": "Asset not found"
          }
        }
      }
    },
    "/api/platform/approvals": {
      "get": {
        "summary": "List assets by approval state",
        "description": "List GeospatialAssets filtered by approval_state.\n\n**Query Parameters:**\n- `status`: Filter by approval state (pending_review, approved, rejected, revoked)\n- `clearance`: Filter by clearance state (uncleared, ouo, public)\n- `limit`: Max results (default: 100)\n\n**Note:** Default behavior returns pending_review assets if no status filter specified.",
        "operationId": "platformApprovalsList",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "description": "Filter by approval state",
            "schema": {
              "type": "string",
              "enum": ["pending_review", "approved", "rejected", "revoked"]
            }
          },
          {
            "name": "clearance",
            "in": "query",
            "description": "Filter by clearance state",
            "schema": {
              "type": "string",
              "enum": ["uncleared", "ouo", "public"]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of assets with approval info",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformApprovalsList"
                }
              }
            }
          }
        }
      }
    },
    "/api/platform/approvals/status": {
      "get": {
        "summary": "Batch approval status lookup",
        "description": "Get approval statuses for multiple items in a single request.\nUseful for UI components that need to show approval badges.\n\n**Query Parameters (at least one required):**\n- `stac_item_ids`: Comma-separated STAC item IDs\n- `stac_collection_ids`: Comma-separated STAC collection IDs\n- `table_names`: Comma-separated table names (for OGC Features)\n\n**Response:** Map of ID -> approval status for quick lookups.",
        "operationId": "platformApprovalsStatus",
        "tags": ["Approvals"],
        "parameters": [
          {
            "name": "stac_item_ids",
            "in": "query",
            "description": "Comma-separated STAC item IDs",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "stac_collection_ids",
            "in": "query",
            "description": "Comma-separated STAC collection IDs",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "table_names",
            "in": "query",
            "description": "Comma-separated table names",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Map of ID to approval status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalStatusMap"
                }
              }
            }
          },
          "400": {
            "description": "No identifiers provided"
          }
        }
      }
    },
    "/api/platform/reject": {
      "post": {
        "summary": "Reject a dataset",
        "description": "Reject a pending dataset with a required reason.\nSets approval_state to REJECTED with audit trail.\n\n**Identification Options (in order of preference):**\n- `asset_id`: GeospatialAsset ID (preferred)\n- `stac_item_id`: STAC item ID\n- `job_id`: CoreMachine job ID\n- `request_id`: Platform request ID\n\n**When to use:**\n- Data quality issues found during QA\n- Incorrect metadata or classification\n- Request should not be published\n\n**After rejection:**\n- Item remains in system but marked as rejected\n- Can be resubmitted with corrections via /api/platform/resubmit",
        "operationId": "platformReject",
        "tags": ["Approvals"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRejectRequest"
              },
              "examples": {
                "byAssetId": {
                  "summary": "By Asset ID (preferred)",
                  "value": {
                    "asset_id": "abc123def456...",
                    "reviewer": "qa@example.com",
                    "reason": "Data quality issues - missing attribute values in 15% of records"
                  }
                },
                "byRequestId": {
                  "summary": "By Request ID",
                  "value": {
                    "request_id": "a3f2c1b8e9d7f6a5...",
                    "reviewer": "qa@example.com",
                    "reason": "Data quality issues - missing attribute values in 15% of records"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Request rejected",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalActionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (reason required)"
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/revoke": {
      "post": {
        "summary": "Revoke an approved dataset",
        "description": "Revoke a previously approved dataset. Sets approval_state to REVOKED (terminal state).\n\n**IMPORTANT:** This is a significant action with audit trail. REVOKED is a terminal state - the asset cannot be re-approved.\n\n**Identification Options (in order of preference):**\n- `asset_id`: GeospatialAsset ID (preferred)\n- `stac_item_id`: STAC item ID\n- `job_id`: CoreMachine job ID\n- `request_id`: Platform request ID\n\n**When to use:**\n- Critical issues discovered after approval\n- Data was approved in error\n- Compliance or security concerns\n\n**After revocation:**\n- Asset marked as REVOKED with full audit trail\n- STAC item updated with revocation properties\n- Cannot be re-approved (must resubmit if correction needed)",
        "operationId": "platformRevoke",
        "tags": ["Approvals"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlatformRevokeRequest"
              },
              "examples": {
                "byAssetId": {
                  "summary": "By Asset ID (preferred)",
                  "value": {
                    "asset_id": "abc123def456...",
                    "revoker": "admin@example.com",
                    "reason": "Critical data quality issue discovered post-approval"
                  }
                },
                "byRequestId": {
                  "summary": "By Request ID",
                  "value": {
                    "request_id": "a3f2c1b8e9d7f6a5...",
                    "revoker": "admin@example.com",
                    "reason": "Re-review required after classification policy update"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Approval revoked",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalActionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Request not in APPROVED state"
          },
          "404": {
            "description": "Request not found"
          }
        }
      }
    },
    "/api/platform/resubmit": {
      "post": {
        "summary": "Resubmit a rejected request",
        "description": "Resubmit a previously rejected request after corrections.\nCreates a new processing job linked to the original request.\n\n**When to use:**\n- After fixing issues identified in rejection\n- Source data has been corrected\n- Metadata has been updated\n\n**Behavior:**\n- Creates new version linked to original\n- Resets approval_state to PENDING\n- Preserves audit history",
        "operationId": "platformResubmit",
        "tags": ["Platform"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResubmitRequest"
              },
              "example": {
                "original_request_id": "a3f2c1b8e9d7f6a5...",
                "container_name": "bronze-rasters",
                "file_name": "aerial-alpha-corrected.tif",
                "notes": "Fixed missing attribute values"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Resubmission accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlatformResponse"
                }
              }
            }
          },
          "400": {
            "description": "Original request not in REJECTED state"
          },
          "404": {
            "description": "Original request not found"
          }
        }
      }
    },
    "/api/platform/catalog/lookup": {
      "get": {
        "summary": "Lookup catalog item by DDH identifiers",
        "description": "Verify a STAC item exists for DDH identifiers.\nReturns item metadata and asset URLs if found.\n\n**Use case:** Verify processing completed and get access URLs.",
        "operationId": "catalogLookup",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "dataset_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "resource_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Catalog item found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogLookupResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found for given identifiers"
          }
        }
      }
    },
    "/api/platform/catalog/item/{collection_id}/{item_id}": {
      "get": {
        "summary": "Get catalog item details",
        "description": "Get full STAC item details including all assets.\nRestricted to items created via Platform (B2B access only).",
        "operationId": "catalogItem",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "collection_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "item_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "STAC item details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogItemResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found"
          }
        }
      }
    },
    "/api/platform/catalog/assets/{collection_id}/{item_id}": {
      "get": {
        "summary": "Get asset URLs for item",
        "description": "Get direct access URLs for all assets in a STAC item.\nReturns COG URLs, MosaicJSON URLs, and any thumbnails.\n\n**Use case:** Get URLs to pass to TiTiler or data clients.",
        "operationId": "catalogAssets",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "collection_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "item_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Asset URLs",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogAssetsResponse"
                }
              }
            }
          },
          "404": {
            "description": "Item not found"
          }
        }
      }
    },
    "/api/platform/catalog/dataset/{dataset_id}": {
      "get": {
        "summary": "List items for DDH dataset",
        "description": "List all STAC items for a DDH dataset identifier.\nReturns all items that have the specified platform:dataset_id.",
        "operationId": "catalogDataset",
        "tags": ["Catalog"],
        "parameters": [
          {
            "name": "dataset_id",
            "in": "path",
            "required": true,
            "description": "DDH dataset identifier",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum items to return",
            "schema": {
              "type": "integer",
              "default": 100,
              "maximum": 1000
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of STAC items",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dataset_id": {
                      "type": "string",
                      "description": "DDH dataset identifier"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of items returned"
                    },
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "item_id": {"type": "string"},
                          "collection_id": {"type": "string"},
                          "bbox": {"type": "array", "items": {"type": "number"}},
                          "datetime": {"type": "string", "format": "date-time"},
                          "resource_id": {"type": "string"},
                          "version_id": {"type": "string"}
                        }
                      }
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                },
                "example": {
                  "dataset_id": "flood-hazard-data",
                  "count": 3,
                  "items": [
                    {
                      "item_id": "flood-v1.0-res001",
                      "collection_id": "flood-hazard-2024",
                      "bbox": [-75.5, -56.5, -66.5, -49.0],
                      "datetime": "2026-01-15T00:00:00Z",
                      "resource_id": "res-001",
                      "version_id": "v1.0"
                    }
                  ],
                  "timestamp": "2026-01-16T10:00:00Z"
                }
              }
            }
          }
        }
      }
    },
  },
  "components": {
    "schemas": {
      "PlatformRequest": {
        "type": "object",
        "required": ["dataset_id", "resource_id", "version_id", "container_name", "file_name"],
        "properties": {
          "dataset_id": {
            "type": "string",
            "maxLength": 255,
            "description": "DDH dataset identifier"
          },
          "resource_id": {
            "type": "string",
            "maxLength": 255,
            "description": "DDH resource identifier"
          },
          "version_id": {
            "type": "string",
            "maxLength": 50,
            "description": "DDH version identifier"
          },
          "previous_version_id": {
            "type": "string",
            "description": "Request ID of previous version for lineage tracking "
          },
          "operation": {
            "type": "string",
            "enum": ["CREATE", "UPDATE", "DELETE"],
            "default": "CREATE"
          },
          "container_name": {
            "type": "string",
            "description": "Azure storage container name"
          },
          "file_name": {
            "oneOf": [
              {"type": "string"},
              {"type": "array", "items": {"type": "string"}}
            ],
            "description": "File name(s) - single string or array for raster collections"
          },
          "title": {
            "type": "string",
            "description": "Human-readable title for the dataset (optional)"
          },
          "clearance_level": {
            "type": "string",
            "enum": ["public", "internal", "restricted"],
            "default": "internal",
            "description": "Data clearance level"
          },
          "description": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {"type": "string"}
          },
          "processing_options": {
            "type": "object",
            "additionalProperties": true,
            "description": "Processing options (crs, nodata_value, overwrite, etc.)"
          }
        }
      },
      "PlatformResponse": {
        "type": "object",
        "properties": {
          "request_id": {
            "type": "string",
            "description": "Idempotent request ID (SHA256 of DDH identifiers)"
          },
          "job_id": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "monitor_url": {
            "type": "string",
            "description": "URL to check request status"
          }
        }
      },
      "PlatformStatusResponse": {
        "type": "object",
        "properties": {
          "request_id": {
            "type": "string"
          },
          "dataset_id": {
            "type": "string"
          },
          "resource_id": {
            "type": "string"
          },
          "version_id": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "job_status": {
            "type": "string",
            "enum": ["queued", "processing", "completed", "failed"]
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "completed_at": {
            "type": "string",
            "format": "date-time"
          },
          "task_summary": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "completed": {"type": "integer"},
              "failed": {"type": "integer"}
            }
          },
          "data_access": {
            "type": "object",
            "description": "Access URLs when job is complete",
            "properties": {
              "stac_collection_id": {"type": "string"},
              "stac_item_id": {"type": "string"},
              "ogc_features_url": {"type": "string"},
              "cog_url": {"type": "string"}
            }
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy", "degraded", "unhealthy"]
          },
          "ready_for_jobs": {
            "type": "boolean"
          },
          "components": {
            "type": "object",
            "properties": {
              "database": {"type": "string"},
              "storage": {"type": "string"},
              "service_bus": {"type": "string"}
            }
          },
          "version": {
            "type": "string"
          }
        }
      },
      "CatalogLookupResponse": {
        "type": "object",
        "properties": {
          "found": {
            "type": "boolean"
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"]
          },
          "collection_id": {
            "type": "string"
          },
          "item_id": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "access_urls": {
            "type": "object",
            "properties": {
              "cog_url": {"type": "string"},
              "mosaic_url": {"type": "string"},
              "ogc_features_url": {"type": "string"},
              "stac_item_url": {"type": "string"}
            }
          }
        }
      },
      "CatalogItemResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["Feature"]
          },
          "stac_version": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "collection": {
            "type": "string"
          },
          "geometry": {
            "type": "object"
          },
          "bbox": {
            "type": "array",
            "items": {"type": "number"}
          },
          "properties": {
            "type": "object",
            "additionalProperties": true
          },
          "assets": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/CatalogAsset"
            }
          }
        }
      },
      "CatalogAsset": {
        "type": "object",
        "properties": {
          "href": {
            "type": "string",
            "format": "uri"
          },
          "type": {
            "type": "string",
            "description": "MIME type (e.g., image/tiff; application=geotiff)"
          },
          "title": {
            "type": "string"
          },
          "roles": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      },
      "CatalogAssetsResponse": {
        "type": "object",
        "properties": {
          "collection_id": {
            "type": "string"
          },
          "item_id": {
            "type": "string"
          },
          "assets": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "href": {"type": "string"},
                "type": {"type": "string"},
                "role": {"type": "string"}
              }
            }
          },
          "titiler_urls": {
            "type": "object",
            "description": "Pre-built TiTiler URLs for common operations",
            "properties": {
              "tiles": {"type": "string"},
              "preview": {"type": "string"},
              "info": {"type": "string"}
            }
          }
        }
      },
      "DryRunResponse": {
        "type": "object",
        "description": "Response from dry_run=true validation ",
        "properties": {
          "valid": {
            "type": "boolean",
            "description": "Whether the request would be accepted"
          },
          "request_id": {
            "type": "string",
            "description": "Computed request ID (deterministic)"
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"],
            "description": "Detected data type"
          },
          "lineage_state": {
            "$ref": "#/components/schemas/LineageState"
          },
          "suggested_params": {
            "type": "object",
            "description": "Recommended processing parameters based on source file analysis",
            "properties": {
              "output_tier": {
                "type": "string",
                "description": "Recommended COG tier based on file size"
              },
              "target_crs": {
                "type": "string",
                "description": "Recommended CRS if reprojection needed"
              },
              "estimated_processing_time": {
                "type": "string",
                "description": "Estimated processing duration"
              }
            }
          },
          "validation_warnings": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Non-blocking warnings about the request"
          },
          "message": {
            "type": "string"
          }
        }
      },
      "LineageState": {
        "type": "object",
        "description": "Version lineage information ",
        "properties": {
          "is_first_version": {
            "type": "boolean",
            "description": "True if this is the first version (no previous)"
          },
          "previous_version": {
            "type": "object",
            "description": "Previous version details (if previous_version_id provided)",
            "properties": {
              "request_id": {"type": "string"},
              "version_id": {"type": "string"},
              "status": {"type": "string"},
              "created_at": {"type": "string", "format": "date-time"}
            }
          },
          "version_chain": {
            "type": "array",
            "description": "Full version history (oldest to newest)",
            "items": {
              "type": "object",
              "properties": {
                "request_id": {"type": "string"},
                "version_id": {"type": "string"},
                "created_at": {"type": "string", "format": "date-time"}
              }
            }
          },
          "total_versions": {
            "type": "integer",
            "description": "Total number of versions in chain"
          }
        }
      },
      "UnpublishRequest": {
        "type": "object",
        "description": "Unified unpublish request ",
        "properties": {
          "dataset_id": {
            "type": "string",
            "description": "DDH dataset identifier (Option 1)"
          },
          "resource_id": {
            "type": "string",
            "description": "DDH resource identifier (Option 1)"
          },
          "version_id": {
            "type": "string",
            "description": "Version identifier (Option 1)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (Option 2)"
          },
          "dry_run": {
            "type": "boolean",
            "default": true,
            "description": "Preview mode - no deletions (default: true)"
          }
        }
      },
      "UnpublishResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "dry_run": {
            "type": "boolean",
            "description": "True if this was a preview (no actual deletion)"
          },
          "data_type": {
            "type": "string",
            "enum": ["vector", "raster"]
          },
          "actions": {
            "type": "array",
            "description": "Actions taken (or would be taken if dry_run)",
            "items": {
              "type": "object",
              "properties": {
                "action": {"type": "string"},
                "target": {"type": "string"},
                "status": {"type": "string"}
              }
            }
          },
          "message": {
            "type": "string"
          }
        }
      },
      "RejectRequest": {
        "type": "object",
        "required": ["request_id", "reviewer", "reason"],
        "properties": {
          "request_id": {
            "type": "string",
            "description": "Platform request ID to reject"
          },
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer"
          },
          "reason": {
            "type": "string",
            "description": "Required rejection reason"
          }
        }
      },
      "RevokeRequest": {
        "type": "object",
        "required": ["request_id", "reviewer"],
        "properties": {
          "request_id": {
            "type": "string",
            "description": "Platform request ID to revoke"
          },
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer"
          },
          "reason": {
            "type": "string",
            "description": "Optional reason for revocation"
          }
        }
      },
      "ResubmitRequest": {
        "type": "object",
        "required": ["original_request_id", "container_name", "file_name"],
        "properties": {
          "original_request_id": {
            "type": "string",
            "description": "Request ID of the rejected request"
          },
          "container_name": {
            "type": "string",
            "description": "Azure storage container for corrected file"
          },
          "file_name": {
            "type": "string",
            "description": "Corrected file name"
          },
          "notes": {
            "type": "string",
            "description": "Notes about what was corrected"
          }
        }
      },
      "ApprovalActionResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "request_id": {
            "type": "string"
          },
          "action": {
            "type": "string",
            "enum": ["approved", "rejected", "revoked"]
          },
          "approval_state": {
            "type": "string",
            "enum": ["PENDING", "APPROVED", "REJECTED", "REVOKED"]
          },
          "reviewer": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "message": {
            "type": "string"
          }
        }
      },
      "EntityState": {
        "type": "object",
        "description": "Three-state entity model",
        "properties": {
          "processing_status": {
            "type": "string",
            "enum": ["PENDING", "PROCESSING", "COMPLETED", "FAILED"],
            "description": "Job processing state"
          },
          "approval_state": {
            "type": "string",
            "enum": ["pending_review", "approved", "rejected", "revoked"],
            "description": "QA approval state"
          },
          "clearance_state": {
            "type": "string",
            "enum": ["uncleared", "ouo", "public"],
            "description": "Data access clearance level"
          }
        }
      },
      "PlatformApproveRequest": {
        "type": "object",
        "description": "Request to approve a dataset for publication",
        "required": ["reviewer", "clearance_level"],
        "properties": {
          "asset_id": {
            "type": "string",
            "description": "GeospatialAsset ID (preferred identifier)"
          },
          "stac_item_id": {
            "type": "string",
            "description": "STAC item ID (alternative identifier)"
          },
          "job_id": {
            "type": "string",
            "description": "CoreMachine job ID (alternative identifier)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (alternative identifier)"
          },
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer (required)"
          },
          "clearance_level": {
            "type": "string",
            "enum": ["ouo", "public"],
            "description": "Clearance level to grant (required)"
          },
          "notes": {
            "type": "string",
            "description": "Optional approval notes"
          }
        }
      },
      "PlatformRejectRequest": {
        "type": "object",
        "description": "Request to reject a pending dataset",
        "required": ["reviewer", "reason"],
        "properties": {
          "asset_id": {
            "type": "string",
            "description": "GeospatialAsset ID (preferred identifier)"
          },
          "stac_item_id": {
            "type": "string",
            "description": "STAC item ID (alternative identifier)"
          },
          "job_id": {
            "type": "string",
            "description": "CoreMachine job ID (alternative identifier)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (alternative identifier)"
          },
          "reviewer": {
            "type": "string",
            "description": "Email of the reviewer (required)"
          },
          "reason": {
            "type": "string",
            "description": "Reason for rejection (required for audit trail)"
          }
        }
      },
      "PlatformRevokeRequest": {
        "type": "object",
        "description": "Request to revoke an approved dataset",
        "required": ["revoker", "reason"],
        "properties": {
          "asset_id": {
            "type": "string",
            "description": "GeospatialAsset ID (preferred identifier)"
          },
          "stac_item_id": {
            "type": "string",
            "description": "STAC item ID (alternative identifier)"
          },
          "job_id": {
            "type": "string",
            "description": "CoreMachine job ID (alternative identifier)"
          },
          "request_id": {
            "type": "string",
            "description": "Platform request ID (alternative identifier)"
          },
          "revoker": {
            "type": "string",
            "description": "Email of the person revoking (required)"
          },
          "reason": {
            "type": "string",
            "description": "Reason for revocation (required for audit trail)"
          }
        }
      },
      "PlatformApprovalResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "asset_id": {
            "type": "string"
          },
          "approval_state": {
            "type": "string",
            "enum": ["approved", "rejected", "revoked"]
          },
          "clearance_state": {
            "type": "string",
            "enum": ["ouo", "public"]
          },
          "action": {
            "type": "string",
            "description": "Action taken (e.g., approved_ouo, approved_public)"
          },
          "stac_updated": {
            "type": "boolean",
            "description": "Whether STAC item was updated"
          },
          "adf_run_id": {
            "type": "string",
            "description": "ADF pipeline run ID (for public approvals)"
          },
          "message": {
            "type": "string"
          }
        }
      },
      "PlatformApprovalsList": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "assets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/GeospatialAssetSummary"
            }
          },
          "count": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "status_counts": {
            "type": "object",
            "properties": {
              "pending_review": {"type": "integer"},
              "approved": {"type": "integer"},
              "rejected": {"type": "integer"},
              "revoked": {"type": "integer"}
            }
          }
        }
      },
      "GeospatialAssetSummary": {
        "type": "object",
        "description": "Summary of a GeospatialAsset for approval workflows",
        "properties": {
          "asset_id": {
            "type": "string"
          },
          "data_type": {
            "type": "string",
            "enum": ["raster", "vector"]
          },
          "stac_item_id": {
            "type": "string"
          },
          "stac_collection_id": {
            "type": "string"
          },
          "approval_state": {
            "type": "string",
            "enum": ["pending_review", "approved", "rejected", "revoked"]
          },
          "clearance_state": {
            "type": "string",
            "enum": ["uncleared", "ouo", "public"]
          },
          "reviewer": {
            "type": "string"
          },
          "reviewed_at": {
            "type": "string",
            "format": "date-time"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApprovalStatusMap": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "statuses": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "has_asset": {
                  "type": "boolean"
                },
                "asset_id": {
                  "type": "string"
                },
                "approval_state": {
                  "type": "string",
                  "enum": ["pending_review", "approved", "rejected", "revoked"]
                },
                "is_approved": {
                  "type": "boolean"
                },
                "clearance_state": {
                  "type": "string"
                },
                "reviewer": {
                  "type": "string"
                },
                "reviewed_at": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        }
      }
    }
  }
}
