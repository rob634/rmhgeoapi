{# ============================================================================
   JINJA2 MACROS - Reusable UI Components
   ============================================================================
   Import and use these macros in any template:

       {% from "components/macros.html" import status_badge, modal, card %}

       {{ status_badge("completed") }}
       {{ card("My Title", "Description text", icon="package") }}

   Available macros:
       - status_badge(status): Colored status indicator
       - card(title, description, icon, footer): Card component
       - stat_item(label, value, highlight): Statistics display
       - spinner(text): Loading spinner
       - empty_state(title, message, icon): Empty state placeholder
       - error_state(title, message): Error display
       - modal(id, title): Modal dialog wrapper
       - confirm_dialog(id, title, message, action_text, action_url): Confirmation modal
       - data_table(columns, rows, id): Data table
       - collection_card(collection): Collection display card
   ============================================================================ #}


{# ============================================================================
   STATUS BADGE
   ============================================================================
   Displays a colored status badge.

   Usage:
       {{ status_badge("completed") }}
       {{ status_badge("failed", "Custom Text") }}

   Supported statuses: queued, pending, processing, completed, failed, active, offline
   ============================================================================ #}
{% macro status_badge(status, text=None) %}
<span class="status-badge status-{{ status|lower }}">
    {{ text if text else status|title }}
</span>
{% endmacro %}


{# ============================================================================
   CARD COMPONENT
   ============================================================================
   Displays a card with optional icon and footer.

   Usage:
       {{ card("Database", "PostgreSQL connection status", icon="database", footer="View Details") }}
   ============================================================================ #}
{% macro card(title, description="", icon="", footer="", href="") %}
{% if href %}
<a href="{{ href }}" class="card">
{% else %}
<div class="card">
{% endif %}
    {% if icon %}
    <div class="card-icon">{{ icon }}</div>
    {% endif %}
    <h3 class="card-title">{{ title }}</h3>
    {% if description %}
    <p class="card-description">{{ description }}</p>
    {% endif %}
    {% if footer %}
    <div class="card-footer">{{ footer }}</div>
    {% endif %}
{% if href %}
</a>
{% else %}
</div>
{% endif %}
{% endmacro %}


{# ============================================================================
   STAT ITEM
   ============================================================================
   Displays a statistic with label and value.

   Usage:
       {{ stat_item("Total Jobs", 1234, highlight=True) }}
   ============================================================================ #}
{% macro stat_item(label, value, highlight=False) %}
<div class="stat-item">
    <div class="stat-label">{{ label }}</div>
    <div class="stat-value {{ 'highlight' if highlight else '' }}">{{ value }}</div>
</div>
{% endmacro %}


{# ============================================================================
   LOADING SPINNER
   ============================================================================
   Displays a loading spinner with optional text.

   Usage:
       {{ spinner("Loading data...") }}
   ============================================================================ #}
{% macro spinner(text="Loading...") %}
<div class="spinner-container">
    <div class="spinner"></div>
    <div class="spinner-text">{{ text }}</div>
</div>
{% endmacro %}


{# ============================================================================
   EMPTY STATE
   ============================================================================
   Displays an empty state placeholder.

   Usage:
       {{ empty_state("No Jobs Found", "Submit a job to get started", "inbox") }}
   ============================================================================ #}
{% macro empty_state(title, message="", icon="inbox") %}
<div class="empty-state">
    <div class="icon">{{ icon }}</div>
    <h3>{{ title }}</h3>
    {% if message %}
    <p>{{ message }}</p>
    {% endif %}
</div>
{% endmacro %}


{# ============================================================================
   ERROR STATE
   ============================================================================
   Displays an error message.

   Usage:
       {{ error_state("Connection Failed", "Unable to connect to database") }}
   ============================================================================ #}
{% macro error_state(title, message="") %}
<div class="error-state">
    <div class="icon">error</div>
    <h3>{{ title }}</h3>
    {% if message %}
    <p class="error-message">{{ message }}</p>
    {% endif %}
</div>
{% endmacro %}


{# ============================================================================
   MODAL DIALOG
   ============================================================================
   Creates a modal dialog wrapper. Use with caller() for content.

   Usage:
       {% call modal("my-modal", "Modal Title") %}
           <p>Modal content goes here</p>
           <button onclick="closeModal('my-modal')">Close</button>
       {% endcall %}
   ============================================================================ #}
{% macro modal(id, title) %}
<div id="{{ id }}" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>{{ title }}</h3>
            <button class="modal-close" onclick="closeModal('{{ id }}')">&times;</button>
        </div>
        <div class="modal-body">
            {{ caller() }}
        </div>
    </div>
</div>
{% endmacro %}


{# ============================================================================
   CONFIRM DIALOG
   ============================================================================
   Creates a confirmation modal with action button.

   Usage:
       {{ confirm_dialog("delete-confirm", "Confirm Delete", "Are you sure?", "Delete", "/api/delete/123") }}
   ============================================================================ #}
{% macro confirm_dialog(id, title, message, action_text, action_url, action_method="POST") %}
<div id="{{ id }}" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>{{ title }}</h3>
            <button class="modal-close" onclick="closeModal('{{ id }}')">&times;</button>
        </div>
        <div class="modal-body">
            <p>{{ message }}</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('{{ id }}')">Cancel</button>
                <button class="btn btn-primary"
                        hx-{{ action_method|lower }}="{{ action_url }}"
                        hx-target="body"
                        hx-swap="none">
                    {{ action_text }}
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}


{# ============================================================================
   DATA TABLE
   ============================================================================
   Creates a data table from columns and rows.

   Usage:
       {{ data_table(
           columns=[
               {"key": "id", "label": "ID"},
               {"key": "name", "label": "Name"},
               {"key": "status", "label": "Status"}
           ],
           rows=[
               {"id": "1", "name": "Job 1", "status": "completed"},
               {"id": "2", "name": "Job 2", "status": "pending"}
           ],
           id="jobs-table"
       ) }}
   ============================================================================ #}
{% macro data_table(columns, rows, id="data-table", empty_message="No data available") %}
<table id="{{ id }}" class="data-table">
    <thead>
        <tr>
            {% for col in columns %}
            <th>{{ col.label }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% if rows %}
            {% for row in rows %}
            <tr>
                {% for col in columns %}
                <td>
                    {% if col.key == 'status' %}
                        {{ status_badge(row[col.key]) }}
                    {% else %}
                        {{ row[col.key] }}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="{{ columns|length }}" style="text-align: center; padding: 40px;">
                    {{ empty_message }}
                </td>
            </tr>
        {% endif %}
    </tbody>
</table>
{% endmacro %}


{# ============================================================================
   COLLECTION CARD
   ============================================================================
   Displays a collection (STAC or Vector) in card format.

   Usage:
       {{ collection_card(collection) }}

   Expected collection object:
       {
           "id": "flood-data",
           "title": "Flood Data",
           "description": "...",
           "type": "stac" or "vector",
           "item_count": 123,
           "created_at": "2026-01-23T12:00:00Z"
       }
   ============================================================================ #}
{% macro collection_card(collection) %}
<div class="collection-card" onclick="viewCollection('{{ collection.id }}', '{{ collection.type }}')">
    <div class="collection-type">
        {% if collection.type == 'stac' %}
        <span class="type-badge type-stac">STAC</span>
        {% else %}
        <span class="type-badge type-vector">Vector</span>
        {% endif %}
    </div>
    <h3>{{ collection.title or collection.id }}</h3>
    <p class="description">{{ collection.description|truncate(150) if collection.description else 'No description' }}</p>
    <div class="meta">
        <span>{{ collection.item_count or 0 }} items</span>
        {% if collection.created_at %}
        <span>{{ collection.created_at[:10] }}</span>
        {% endif %}
    </div>
</div>
{% endmacro %}


{# ============================================================================
   SERVICE STATUS CARD
   ============================================================================
   Displays a service status card for health dashboard.

   Usage:
       {{ service_status_card("Database", "PostgreSQL", status="healthy", details={"host": "localhost"}) }}
   ============================================================================ #}
{% macro service_status_card(name, description, status="unknown", details=None) %}
<div class="service-card status-{{ status }}">
    <div class="service-header">
        <span class="service-name">{{ name }}</span>
        {{ status_badge(status) }}
    </div>
    <p class="service-description">{{ description }}</p>
    {% if details %}
    <ul class="service-details">
        {% for key, value in details.items() %}
        <li><strong>{{ key }}:</strong> {{ value }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endmacro %}
